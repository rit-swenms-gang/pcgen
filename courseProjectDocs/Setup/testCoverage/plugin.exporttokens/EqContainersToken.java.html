<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EqContainersToken.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">plugin.exporttokens</a> &gt; <span class="el_source">EqContainersToken.java</span></div><h1>EqContainersToken.java</h1><pre class="source lang-java linenums">/*
 * EqContainersToken.java
 * Copyright 2003 (C) Devon Jones &lt;soulcatcher@evilsoft.org&gt;
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.     See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 */
package plugin.exporttokens;

import java.math.BigDecimal;
import java.util.StringTokenizer;

import pcgen.cdom.enumeration.FormulaKey;
import pcgen.core.Equipment;
import pcgen.core.Globals;
import pcgen.core.PlayerCharacter;
import pcgen.core.analysis.OutputNameFormatting;
import pcgen.io.ExportHandler;
import pcgen.io.exporttoken.EqToken;
import pcgen.io.exporttoken.Token;
import pcgen.util.BigDecimalHelper;

/**
 * Deals with Tokens below:
 *
 * EQCONTAINERS.x.ACCHECK
 * EQCONTAINERS.x.ACMOD
 * EQCONTAINERS.x.ALTCRIT
 * EQCONTAINERS.x.ALTDAMAGE
 * EQCONTAINERS.x.ATTACKS
 * EQCONTAINERS.x.CARRIED
 * EQCONTAINERS.x.CONTENTS.?
 * EQCONTAINERS.x.CONTENTWEIGHT
 * EQCONTAINERS.x.COST
 * EQCONTAINERS.x.CRITMULT
 * EQCONTAINERS.x.CRITRANGE
 * EQCONTAINERS.x.DAMAGE
 * EQCONTAINERS.x.EDR
 * EQCONTAINERS.x.EQUIPPED
 * EQCONTAINERS.x.ITEMWEIGHT
 * EQCONTAINERS.x.LOCATION
 * EQCONTAINERS.x.LONGNAME
 * EQCONTAINERS.x.MAXDEX
 * EQCONTAINERS.x.MOVE
 * EQCONTAINERS.x.NAME
 * EQCONTAINERS.x.OUTPUTNAME
 * EQCONTAINERS.x.PROF
 * EQCONTAINERS.x.QTY
 * EQCONTAINERS.x.RANGE
 * EQCONTAINERS.x.SIZE
 * EQCONTAINERS.x.SPELLFAILURE
 * EQCONTAINERS.x.SPROP
 * EQCONTAINERS.x.TOTALWEIGHT
 * EQCONTAINERS.x.TYPE.?
 * EQCONTAINERS.x.WT
 */
<span class="nc" id="L68">public class EqContainersToken extends Token</span>
{
	/** Token Name */
	public static final String TOKENNAME = &quot;EQCONTAINERS&quot;;
	/** Indent, a Tab Character */
	public static final String INDENT = &quot;\t&quot;;

	@Override
	public String getTokenName()
	{
<span class="nc" id="L78">		return TOKENNAME;</span>
	}

	@Override
	public String getToken(String tokenSource, PlayerCharacter pc, ExportHandler eh)
	{
<span class="nc" id="L84">		String retString = &quot;&quot;;</span>
<span class="nc" id="L85">		StringTokenizer aTok = new StringTokenizer(tokenSource, &quot;.&quot;, false);</span>
<span class="nc" id="L86">		aTok.nextToken(); //clear EQCONTAINERS Token</span>
<span class="nc" id="L87">		Equipment eq = null;</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (aTok.hasMoreElements())</span>
		{
			try
			{
<span class="nc" id="L92">				int containerNo = Integer.parseInt(aTok.nextToken());</span>
<span class="nc" id="L93">				eq = getContainer(pc, containerNo);</span>
			}
<span class="nc" id="L95">			catch (NumberFormatException e)</span>
			{
				// TODO - This exception needs to be handled
<span class="nc" id="L98">			}</span>
		}

<span class="nc bnc" id="L101" title="All 2 branches missed.">		if (eq != null)</span>
		{
<span class="nc" id="L103">			String property = &quot;NAME&quot;;</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">			if (aTok.hasMoreElements())</span>
			{
<span class="nc" id="L106">				property = aTok.nextToken();</span>
			}

<span class="nc bnc" id="L109" title="All 29 branches missed.">			switch (property)</span>
			{
<span class="nc" id="L111">				case &quot;ACCHECK&quot; -&gt; retString = Integer.toString(EqToken.getAcCheckTokenInt(pc, eq));</span>
<span class="nc" id="L112">				case &quot;ACMOD&quot; -&gt; retString = Integer.toString(getAcModToken(pc, eq));</span>
<span class="nc" id="L113">				case &quot;ALTCRIT&quot; -&gt; retString = getAltCritToken(eq);</span>
<span class="nc" id="L114">				case &quot;ALTDAMAGE&quot; -&gt; retString = getAltDamageToken(pc, eq);</span>
<span class="nc" id="L115">				case &quot;ATTACKS&quot; -&gt; retString = Double.toString(getAttacksToken(pc, eq));</span>
<span class="nc" id="L116">				case &quot;CARRIED&quot; -&gt; retString = Float.toString(getCarriedToken(eq));</span>
<span class="nc" id="L117">				case &quot;CONTENTS&quot; -&gt; retString = getContentsToken(eq, aTok);</span>
<span class="nc" id="L118">				case &quot;CONTENTWEIGHT&quot; -&gt; retString =</span>
<span class="nc" id="L119">						BigDecimalHelper.trimZeros(Float.toString(getContentWeightToken(pc, eq)));</span>
<span class="nc" id="L120">				case &quot;COST&quot; -&gt; retString = BigDecimalHelper.trimZeros(getCostToken(pc, eq));</span>
<span class="nc" id="L121">				case &quot;CRITMULT&quot; -&gt; retString = getCritMultToken(eq);</span>
<span class="nc" id="L122">				case &quot;CRITRANGE&quot; -&gt; retString = EqToken.getCritRangeToken(pc, eq);</span>
<span class="nc" id="L123">				case &quot;DAMAGE&quot; -&gt; retString = getDamageToken(pc, eq);</span>
<span class="nc" id="L124">				case &quot;EDR&quot; -&gt; retString = Integer.toString(EqToken.getEdrTokenInt(pc, eq));</span>
<span class="nc" id="L125">				case &quot;EQUIPPED&quot; -&gt; retString = getEquippedToken(eq);</span>
<span class="nc" id="L126">				case &quot;ITEMWEIGHT&quot; -&gt; retString = BigDecimalHelper.trimZeros(Float.toString(getItemWeightToken(pc,</span>
						eq)));
<span class="nc" id="L128">				case &quot;LOCATION&quot; -&gt; retString = getLocationToken(eq);</span>
<span class="nc" id="L129">				case &quot;LONGNAME&quot; -&gt; retString = getLongNameToken(eq);</span>
<span class="nc" id="L130">				case &quot;MAXDEX&quot; -&gt; retString = Integer.toString(EqToken.getMaxDexTokenInt(pc, eq));</span>
<span class="nc" id="L131">				case &quot;MOVE&quot; -&gt; retString = getMoveToken(eq);</span>
<span class="nc" id="L132">				case &quot;NAME&quot;, &quot;OUTPUTNAME&quot; -&gt; retString = getNameToken(eq, pc);</span>
<span class="nc" id="L133">				case &quot;PROF&quot; -&gt; retString = eq.consolidatedProfName();</span>
<span class="nc" id="L134">				case &quot;QTY&quot; -&gt; retString = BigDecimalHelper.trimZeros(Double.toString((getQuantityToken(eq))));</span>
<span class="nc" id="L135">				case &quot;RANGE&quot; -&gt; retString = Integer.toString(EqToken.getRange(pc, eq));</span>
<span class="nc" id="L136">				case &quot;SIZE&quot; -&gt; retString = getSizeToken(eq);</span>
<span class="nc" id="L137">				case &quot;SPELLFAILURE&quot; -&gt; retString = Integer.toString(EqToken.getSpellFailureTokenInt(pc, eq));</span>
<span class="nc" id="L138">				case &quot;SPROP&quot; -&gt; retString = getSPropToken(pc, eq);</span>
<span class="nc" id="L139">				case &quot;TOTALWEIGHT&quot;, &quot;WT&quot; -&gt; retString =</span>
<span class="nc" id="L140">						BigDecimalHelper.trimZeros(Float.toString(getTotalWeightToken(pc, eq)));</span>
<span class="nc" id="L141">				case &quot;TYPE&quot; -&gt; retString = getTypeToken(eq, aTok);</span>
			}
		}
<span class="nc" id="L144">		return retString;</span>
	}

	/**
	 * Get the AC Mod Token
	 * @param pc
	 * @param eq
	 * @return AC Mod Token
	 */
	public static int getAcModToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L155">		return eq.getACMod(pc);</span>
	}

	/**
	 * Get Alternative Critical Token
	 * @param eq
	 * @return Alternative Critical Token
	 */
	public static String getAltCritToken(Equipment eq)
	{
<span class="nc" id="L165">		return EqToken.getAltCritMultToken(eq);</span>
	}

	/**
	 * Get alternative damage token
	 * @param pc
	 * @param eq
	 * @return alternative damage token
	 */
	public static String getAltDamageToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L176">		return eq.getAltDamage(pc);</span>
	}

	/**
	 * Get Attacks token
	 * @param pc
	 * @param eq
	 * @return Attacks token
	 */
	public static double getAttacksToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L187">		return eq.bonusTo(pc, &quot;COMBAT&quot;, &quot;ATTACKS&quot;, true);</span>
	}

	/**
	 * Get Carried token
	 * @param eq
	 * @return Carried token
	 */
	public static float getCarriedToken(Equipment eq)
	{
<span class="nc" id="L197">		return eq.numberCarried();</span>
	}

	/**
	 * Get Contents Token
	 * @param eq
	 * @param aTok
	 * @return Contents Token
	 */
	public static String getContentsToken(Equipment eq, StringTokenizer aTok)
	{
		String retString;
<span class="nc bnc" id="L209" title="All 2 branches missed.">		if (aTok.hasMoreTokens())</span>
		{
<span class="nc" id="L211">			String aType = aTok.nextToken();</span>
<span class="nc" id="L212">			String aSubTag = &quot;NAME&quot;;</span>

<span class="nc bnc" id="L214" title="All 2 branches missed.">			if (aTok.hasMoreTokens())</span>
			{
<span class="nc" id="L216">				aSubTag = aTok.nextToken();</span>
			}

<span class="nc" id="L219">			retString = eq.getContainerByType(aType, aSubTag);</span>
<span class="nc" id="L220">		}</span>
		else
		{
<span class="nc" id="L223">			retString = eq.getContainerContentsString();</span>
		}
<span class="nc" id="L225">		return retString;</span>
	}

	/**
	 * Get Content Weight Token
	 * @param pc
	 * @param eq
	 * @return Content Weight Token
	 */
	public static float getContentWeightToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc bnc" id="L236" title="All 2 branches missed.">		if (eq.getChildCount() == 0)</span>
		{
<span class="nc" id="L238">			return 0;</span>
		}
<span class="nc" id="L240">		return eq.getContainedWeight(pc);</span>
	}

	/**
	 * Get Cost token
	 * @param pc
	 * @param eq
	 * @return Cost token
	 */
	public static BigDecimal getCostToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L251">		return eq.getCost(pc);</span>
	}

	/**
	 * Get Critical Multiplier Token
	 * @param eq
	 * @return Critical Multiplier Token
	 */
	public static String getCritMultToken(Equipment eq)
	{
<span class="nc" id="L261">		return EqToken.getCritMultToken(eq);</span>
	}

	/**
	 * Get Damage Token
	 * @param pc
	 * @param eq
	 * @return Damage Token
	 */
	public static String getDamageToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L272">		String retString = eq.getDamage(pc);</span>

<span class="nc bnc" id="L274" title="All 4 branches missed.">		if ((pc != null) &amp;&amp; (eq.isNatural()))</span>
		{
<span class="nc" id="L276">			retString = Globals.adjustDamage(retString,</span>
<span class="nc" id="L277">				pc.sizeInt() - pc.getDisplay().getRace()</span>
<span class="nc" id="L278">					.getSafe(FormulaKey.SIZE).resolve(pc, &quot;&quot;).intValue());</span>
		}

<span class="nc" id="L281">		return retString;</span>
	}

	/**
	 * Get Equipped Token
	 * @param eq
	 * @return Equipped Token
	 */
	public static String getEquippedToken(Equipment eq)
	{
<span class="nc bnc" id="L291" title="All 2 branches missed.">		if (eq.isEquipped())</span>
		{
<span class="nc" id="L293">			return &quot;Y&quot;;</span>
		}
<span class="nc" id="L295">		return &quot;N&quot;;</span>
	}

	/**
	 * Get Item Weight Token
	 * @param pc
	 * @param eq
	 * @return Item Weight Token
	 */
	public static float getItemWeightToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L306">		return eq.getWeight(pc);</span>
	}

	/**
	 * Get Location Token
	 * @param eq
	 * @return Location Token
	 */
	public static String getLocationToken(Equipment eq)
	{
<span class="nc" id="L316">		return eq.getParentName();</span>
	}

	/**
	 * Get Long Name Token
	 * @param eq
	 * @return Long Name Token
	 */
	public static String getLongNameToken(Equipment eq)
	{
<span class="nc" id="L326">		StringBuilder retString = new StringBuilder();</span>
<span class="nc" id="L327">		int depth = eq.itemDepth();</span>

<span class="nc bnc" id="L329" title="All 2 branches missed.">		while (depth &gt; 0)</span>
		{
<span class="nc" id="L331">			retString.append(INDENT);</span>
<span class="nc" id="L332">			--depth;</span>
		}

<span class="nc" id="L335">		retString.append(eq.longName());</span>
<span class="nc" id="L336">		return retString.toString();</span>
	}

	/**
	 * Get Move Token
	 * @param eq
	 * @return Move Token
	 */
	public static String getMoveToken(Equipment eq)
	{
<span class="nc" id="L346">		return eq.moveString();</span>
	}

	/**
	 * Get Name Token
	 * @param eq
	 * @param pc
	 * @return Name Token
	 */
	public static String getNameToken(Equipment eq, PlayerCharacter pc)
	{
<span class="nc" id="L357">		return OutputNameFormatting.parseOutputName(eq, pc);</span>
	}

	/**
	 * Get Quantity Token
	 * @param eq
	 * @return Quantity Token
	 */
	public static double getQuantityToken(Equipment eq)
	{
<span class="nc" id="L367">		return eq.qty();</span>
	}

	/**
	 * Get Size Token
	 * @param eq
	 * @return Size Token
	 */
	public static String getSizeToken(Equipment eq)
	{
<span class="nc" id="L377">		return eq.getSize();</span>
	}

	/**
	 * Get Special Property Token
	 * @param pc
	 * @param eq
	 * @return Special Property Token
	 */
	public static String getSPropToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L388">		return eq.getSpecialProperties(pc);</span>
	}

	/**
	 * Get Total Weight Token
	 * @param pc
	 * @param eq
	 * @return Total Weight Token
	 */
	public static float getTotalWeightToken(PlayerCharacter pc, Equipment eq)
	{
<span class="nc" id="L399">		return getContentWeightToken(pc, eq) + getItemWeightToken(pc, eq);</span>
	}

	/**
	 * Get Type Token
	 * @param eq
	 * @param aTok
	 * @return Type Token
	 */
	public static String getTypeToken(Equipment eq, StringTokenizer aTok)
	{
<span class="nc" id="L410">		String retString = &quot;&quot;;</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">		if (aTok.hasMoreTokens())</span>
		{
			try
			{
<span class="nc" id="L415">				int x = Integer.parseInt(aTok.nextToken());</span>
<span class="nc" id="L416">				retString = eq.typeIndex(x);</span>
			}
<span class="nc" id="L418">			catch (NumberFormatException e)</span>
			{
				// TODO - This exception needs to be handled
<span class="nc" id="L421">			}</span>
		}
		else
		{
<span class="nc" id="L425">			retString = eq.getType();</span>
		}
<span class="nc" id="L427">		return retString;</span>
	}

	private Equipment getContainer(PlayerCharacter pc, int no)
	{
<span class="nc bnc" id="L432" title="All 2 branches missed.">		for (Equipment eq : pc.getEquipmentListInOutputOrder())</span>
		{
<span class="nc bnc" id="L434" title="All 2 branches missed.">			if (eq.isContainer())</span>
			{
<span class="nc" id="L436">				no--;</span>
			}

<span class="nc bnc" id="L439" title="All 2 branches missed.">			if (no &lt; 0)</span>
			{
<span class="nc" id="L441">				return eq;</span>
			}
<span class="nc" id="L443">		}</span>
<span class="nc" id="L444">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>