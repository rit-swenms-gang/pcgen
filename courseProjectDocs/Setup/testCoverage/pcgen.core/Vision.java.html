<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Vision.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.core</a> &gt; <span class="el_source">Vision.java</span></div><h1>Vision.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2006 (C) Tom Parker &lt;thpr@users.sourceforge.net&gt;
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
 *
 */
package pcgen.core;

import java.util.Objects;

import pcgen.base.formula.Formula;
import pcgen.cdom.base.CDOMObject;
import pcgen.cdom.base.CDOMReference;
import pcgen.cdom.base.FormulaFactory;
import pcgen.cdom.list.VisionList;
import pcgen.cdom.reference.CDOMDirectSingleRef;
import pcgen.util.enumeration.VisionType;

public class Vision extends CDOMObject implements Comparable&lt;Vision&gt;
{

	public static final CDOMReference&lt;VisionList&gt; VISIONLIST;

	static
	{
<span class="fc" id="L39">		VisionList wpl = new VisionList();</span>
<span class="fc" id="L40">		wpl.setName(&quot;*Vision&quot;);</span>
<span class="fc" id="L41">		VISIONLIST = CDOMDirectSingleRef.getRef(wpl);</span>
<span class="fc" id="L42">	}</span>

	private final VisionType visionType;

	private final Formula distance;

	public Vision(VisionType type, Formula dist)
<span class="fc" id="L49">	{</span>
<span class="fc" id="L50">		Objects.requireNonNull(type, &quot;Vision Type cannot be null&quot;);</span>
<span class="fc" id="L51">		visionType = type;</span>
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">		if (!dist.isValid())</span>
		{
<span class="nc" id="L54">			throw new IllegalArgumentException(&quot;Vision Type distance must be valid&quot;);</span>
		}
<span class="fc" id="L56">		distance = dist;</span>
<span class="fc" id="L57">	}</span>

	public Formula getDistance()
	{
<span class="nc" id="L61">		return distance;</span>
	}

	public VisionType getType()
	{
<span class="nc" id="L66">		return visionType;</span>
	}

	@Override
	public String toString()
	{
		try
		{
<span class="fc" id="L74">			return toString(Integer.parseInt(distance.toString()));</span>
		}
<span class="fc" id="L76">		catch (NumberFormatException e)</span>
		{
<span class="fc" id="L78">			return visionType + &quot; (&quot; + distance + ')';</span>
		}
	}

	private String toString(int dist)
	{
<span class="fc" id="L84">		String vision = visionType + &quot; (&quot; + dist + &quot;')&quot;;</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">		if (dist &lt;= 0)</span>
		{
<span class="fc" id="L87">			vision = visionType.toString();</span>
		}
<span class="fc" id="L89">		return vision;</span>
	}

	@Override
	public boolean equals(Object obj)
	{
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">		if (obj instanceof Vision v)</span>
		{
<span class="fc bfc" id="L97" title="All 4 branches covered.">			return distance.equals(v.distance) &amp;&amp; visionType.equals(v.visionType);</span>
		}
<span class="nc" id="L99">		return false;</span>
	}

	@Override
	public int hashCode()
	{
<span class="fc" id="L105">		return distance.hashCode() ^ visionType.hashCode();</span>
	}

	public String toString(PlayerCharacter aPC)
	{
<span class="nc" id="L110">		return toString(distance.resolve(aPC, &quot;&quot;).intValue());</span>
	}

	@Override
	public int compareTo(Vision v)
	{
		//CONSIDER This is potentially a slow method, but definitely works - thpr 10/26/06
<span class="nc" id="L117">		return toString().compareTo(v.toString());</span>
	}

	public static Vision getVision(String visionType)
	{
		// expecting value in form of Darkvision (60') or Darkvision
<span class="fc" id="L123">		int commaLoc = visionType.indexOf(',');</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">		if (commaLoc != -1)</span>
		{
<span class="fc" id="L126">			throw new IllegalArgumentException(&quot;Invalid Vision: &quot; + visionType + &quot;. May not contain a comma&quot;);</span>
		}
<span class="fc" id="L128">		int quoteLoc = visionType.indexOf('\'');</span>
<span class="fc" id="L129">		int openParenLoc = visionType.indexOf('(');</span>
		Formula distance;
		String type;
<span class="fc bfc" id="L132" title="All 2 branches covered.">		if (openParenLoc == -1)</span>
		{
<span class="fc bfc" id="L134" title="All 2 branches covered.">			if (visionType.indexOf(')') != -1)</span>
			{
<span class="fc" id="L136">				throw new IllegalArgumentException(</span>
					&quot;Invalid Vision: &quot; + visionType + &quot;. Had close paren without open paren&quot;);
			}
<span class="fc bfc" id="L139" title="All 2 branches covered.">			if (quoteLoc != -1)</span>
			{
<span class="fc" id="L141">				throw new IllegalArgumentException(&quot;Invalid Vision: &quot; + visionType + &quot;. Had quote parens&quot;);</span>
			}
<span class="fc" id="L143">			type = visionType;</span>
<span class="fc" id="L144">			distance = FormulaFactory.ZERO;</span>
		}
		else
		{
<span class="fc" id="L148">			int length = visionType.length();</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">			if (visionType.indexOf(')') != length - 1)</span>
			{
<span class="fc" id="L151">				throw new IllegalArgumentException(</span>
					&quot;Invalid Vision: &quot; + visionType + &quot;. Close paren not at end of string&quot;);
			}
<span class="fc" id="L154">			int endDistance = length - 1;</span>
<span class="fc bfc" id="L155" title="All 2 branches covered.">			if (quoteLoc != -1)</span>
			{
<span class="fc bfc" id="L157" title="All 2 branches covered.">				if (quoteLoc == length - 2)</span>
				{
<span class="fc" id="L159">					endDistance--;</span>
				}
				else
				{
<span class="fc" id="L163">					throw new IllegalArgumentException(</span>
						&quot;Invalid Vision: &quot; + visionType + &quot;. Foot character ' not immediately before close paren&quot;);
				}
			}
<span class="fc" id="L167">			type = visionType.substring(0, openParenLoc).trim();</span>
<span class="fc" id="L168">			String dist = visionType.substring(openParenLoc + 1, endDistance);</span>
<span class="pc bpc" id="L169" title="1 of 2 branches missed.">			if (dist.isEmpty())</span>
			{
<span class="nc" id="L171">				throw new IllegalArgumentException(&quot;Invalid Vision: &quot; + visionType + &quot;. No Distance provided&quot;);</span>
			}
<span class="fc bfc" id="L173" title="All 2 branches covered.">			if (quoteLoc != -1)</span>
			{
				try
				{
<span class="fc" id="L177">					Integer.parseInt(dist);</span>
				}
<span class="fc" id="L179">				catch (NumberFormatException nfe)</span>
				{
<span class="fc" id="L181">					throw new IllegalArgumentException(</span>
						&quot;Invalid Vision: &quot; + visionType + &quot;. Vision Distance with Foot character ' was not an &quot;
								+ &quot;integer&quot;, nfe);
<span class="fc" id="L184">				}</span>
			}
<span class="fc" id="L186">			distance = FormulaFactory.getFormulaFor(dist);</span>
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">			if (!distance.isValid())</span>
			{
<span class="nc" id="L189">				throw new IllegalArgumentException(&quot;Invalid: Vision Distance was not valid: &quot; + distance);</span>
			}
		}
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">		if (type.isEmpty())</span>
		{
<span class="nc" id="L194">			throw new IllegalArgumentException(&quot;Invalid Vision: &quot; + visionType + &quot;. No Vision Type provided&quot;);</span>
		}
<span class="fc" id="L196">		return new Vision(VisionType.getVisionType(type), distance);</span>
	}

	@Override
	public boolean isType(String str)
	{
<span class="nc" id="L202">		return false;</span>
	}

	@Override
	public String getKeyName()
	{
<span class="fc" id="L208">		return toString();</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>