<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SourceSelectionDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.sources</a> &gt; <span class="el_source">SourceSelectionDialog.java</span></div><h1>SourceSelectionDialog.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2010 Connor Petty &lt;cpmeister@users.sourceforge.net&gt;
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 */
package pcgen.gui2.sources;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Point;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.AbstractList;
import java.util.Collections;
import java.util.List;
import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.DefaultListCellRenderer;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSplitPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextField;
import javax.swing.ListModel;
import javax.swing.ListSelectionModel;
import javax.swing.WindowConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import pcgen.core.Campaign;
import pcgen.core.GameMode;
import pcgen.facade.core.LoadableFacade.LoadingState;
import pcgen.facade.core.SourceSelectionFacade;
import pcgen.facade.util.ListFacade;
import pcgen.facade.util.ListFacades;
import pcgen.facade.util.SortedListFacade;
import pcgen.gui2.PCGenFrame;
import pcgen.gui2.UIContext;
import pcgen.gui2.UIPropertyContext;
import pcgen.gui2.dialog.DataInstaller;
import pcgen.gui2.tools.CommonMenuText;
import pcgen.gui2.tools.FlippingSplitPane;
import pcgen.gui2.tools.InfoPane;
import pcgen.gui2.tools.InfoPaneLinkAction;
import pcgen.gui2.tools.Utility;
import pcgen.gui2.util.FacadeListModel;
import pcgen.gui3.utilty.ColorUtilty;
import pcgen.system.FacadeFactory;
import pcgen.system.LanguageBundle;
import pcgen.util.Comparators;

public class SourceSelectionDialog extends JDialog implements ActionListener, ChangeListener, ListSelectionListener
{

<span class="nc" id="L81">	private static final UIPropertyContext CONTEXT =</span>
<span class="nc" id="L82">			UIPropertyContext.createContext(&quot;SourceSelectionDialog&quot;); //$NON-NLS-1$</span>
	private static final String PROP_SELECTED_SOURCE = &quot;selectedSource&quot;; //$NON-NLS-1$
	private static final String LOAD_COMMAND = &quot;Load&quot;; //$NON-NLS-1$
	private static final String CANCEL_COMMAND = &quot;Cancel&quot;; //$NON-NLS-1$
	private static final String SAVE_COMMAND = &quot;Save&quot;; //$NON-NLS-1$
	private static final String DELETE_COMMAND = &quot;Delete&quot;; //$NON-NLS-1$
	private static final String INSTALLDATA_COMMAND = &quot;Install&quot;; //$NON-NLS-1$
	private final PCGenFrame frame;
	private final QuickSourceSelectionPanel basicPanel;
	private final AdvancedSourceSelectionPanel advancedPanel;
	private final JTabbedPane tabs;
	private final JPanel buttonPanel;
	private final JButton loadButton;
	private final JButton cancelButton;
	private final JButton deleteButton;
	private final JButton installDataButton;
	private final JButton saveButton;
	private final JCheckBox alwaysAdvancedCheck;

	public SourceSelectionDialog(PCGenFrame frame, UIContext uiContext)
	{
<span class="nc" id="L103">		super(frame, true);</span>
<span class="nc" id="L104">		this.frame = frame;</span>
<span class="nc" id="L105">		setTitle(LanguageBundle.getString(&quot;in_mnuSourcesLoadSelect&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L106">		this.tabs = new JTabbedPane();</span>
<span class="nc" id="L107">		this.basicPanel = new QuickSourceSelectionPanel();</span>
<span class="nc" id="L108">		this.advancedPanel = new AdvancedSourceSelectionPanel(frame, uiContext);</span>
<span class="nc" id="L109">		this.buttonPanel = new JPanel();</span>
<span class="nc" id="L110">		this.loadButton = new JButton();</span>
<span class="nc" id="L111">		CommonMenuText.name(loadButton, &quot;load&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L112">		this.cancelButton = new JButton();</span>
<span class="nc" id="L113">		CommonMenuText.name(cancelButton, &quot;cancel&quot;); //$NON-NLS-1$</span>

<span class="nc" id="L115">		this.deleteButton = new JButton();</span>
<span class="nc" id="L116">		CommonMenuText.name(deleteButton, &quot;delete&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L117">		this.installDataButton = new JButton();</span>
<span class="nc" id="L118">		CommonMenuText.name(installDataButton, &quot;mnuSourcesInstallData&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L119">		this.saveButton = new JButton();</span>
<span class="nc" id="L120">		CommonMenuText.name(saveButton, &quot;saveSelection&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L121">		this.alwaysAdvancedCheck = new JCheckBox(LanguageBundle.getString(&quot;in_sourceAlwaysAdvanced&quot;), //$NON-NLS-1$</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">			!UIPropertyContext.getInstance().initBoolean(UIPropertyContext.SOURCE_USE_BASIC_KEY, true));</span>
<span class="nc" id="L123">		setDefaultCloseOperation(WindowConstants.HIDE_ON_CLOSE);</span>
<span class="nc" id="L124">		initComponents();</span>
<span class="nc" id="L125">		initDefaults();</span>
<span class="nc" id="L126">		pack();</span>
<span class="nc" id="L127">	}</span>

	public static boolean skipSourceSelection()
	{
<span class="nc" id="L131">		return UIPropertyContext.getInstance().initBoolean(UIPropertyContext.SKIP_SOURCE_SELECTION, false);</span>
	}

	private void initComponents()
	{
<span class="nc" id="L136">		Container pane = getContentPane();</span>
<span class="nc" id="L137">		pane.setLayout(new BorderLayout());</span>

<span class="nc" id="L139">		tabs.add(LanguageBundle.getString(&quot;in_basic&quot;), basicPanel); //$NON-NLS-1$</span>
<span class="nc" id="L140">		tabs.add(LanguageBundle.getString(&quot;in_advanced&quot;), advancedPanel); //$NON-NLS-1$</span>
<span class="nc" id="L141">		tabs.addChangeListener(this);</span>
<span class="nc" id="L142">		pane.add(tabs, BorderLayout.CENTER);</span>

<span class="nc" id="L144">		loadButton.setDefaultCapable(true);</span>
<span class="nc" id="L145">		getRootPane().setDefaultButton(loadButton);</span>

<span class="nc" id="L147">		loadButton.setActionCommand(LOAD_COMMAND);</span>
<span class="nc" id="L148">		cancelButton.setActionCommand(CANCEL_COMMAND);</span>
<span class="nc" id="L149">		deleteButton.setActionCommand(DELETE_COMMAND);</span>
<span class="nc" id="L150">		saveButton.setActionCommand(SAVE_COMMAND);</span>
<span class="nc" id="L151">		installDataButton.setActionCommand(INSTALLDATA_COMMAND);</span>

<span class="nc" id="L153">		loadButton.addActionListener(this);</span>
<span class="nc" id="L154">		cancelButton.addActionListener(this);</span>
<span class="nc" id="L155">		saveButton.addActionListener(this);</span>
<span class="nc" id="L156">		deleteButton.addActionListener(this);</span>
<span class="nc" id="L157">		installDataButton.addActionListener(this);</span>

<span class="nc" id="L159">		Box buttons = Box.createHorizontalBox();</span>
<span class="nc" id="L160">		buttons.add(buttonPanel);</span>
<span class="nc" id="L161">		buttons.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L162">		buttons.add(installDataButton);</span>
<span class="nc" id="L163">		buttons.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L164">		buttons.add(loadButton);</span>
<span class="nc" id="L165">		buttons.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L166">		buttons.add(cancelButton);</span>
<span class="nc" id="L167">		buttons.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L168">		pane.add(buttons, BorderLayout.SOUTH);</span>

<span class="nc" id="L170">		Utility.installEscapeCloseOperation(this);</span>
<span class="nc" id="L171">	}</span>

	private void initDefaults()
	{
<span class="nc" id="L175">		boolean useBasic = CONTEXT.initBoolean(&quot;useBasic&quot;, true); //$NON-NLS-1$</span>
<span class="nc" id="L176">		SourceSelectionFacade selection = basicPanel.getSourceSelection();</span>
<span class="nc bnc" id="L177" title="All 4 branches missed.">		if (selection != null &amp;&amp; useBasic)</span>
		{
<span class="nc" id="L179">			basicPanel.makeSourceSelected(selection);</span>
		}
		else
		{
<span class="nc" id="L183">			deleteButton.setEnabled(false);</span>
		}
<span class="nc" id="L185">		buttonPanel.setLayout(new BoxLayout(buttonPanel, BoxLayout.X_AXIS));</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">		if (useBasic)</span>
		{
<span class="nc" id="L188">			setBasicButtons();</span>
<span class="nc" id="L189">			advancedPanel.setSourceSelection(basicPanel.getSourceSelection());</span>
		}
		else
		{
<span class="nc" id="L193">			setAdvancedButtons();</span>
<span class="nc" id="L194">			tabs.setSelectedIndex(1);</span>
		}
<span class="nc" id="L196">	}</span>

	@Override
	public void valueChanged(ListSelectionEvent e)
	{
<span class="nc bnc" id="L201" title="All 2 branches missed.">		if (!e.getValueIsAdjusting())</span>
		{
<span class="nc" id="L203">			SourceSelectionFacade selection = basicPanel.getSourceSelection();</span>
<span class="nc" id="L204">			deleteButton.setEnabled(selection.isModifiable());</span>
<span class="nc" id="L205">			advancedPanel.setSourceSelection(selection);</span>
		}
<span class="nc" id="L207">	}</span>

	private void setBasicButtons()
	{
<span class="nc" id="L211">		buttonPanel.removeAll();</span>
<span class="nc" id="L212">		buttonPanel.add(deleteButton);</span>
<span class="nc" id="L213">		buttonPanel.revalidate();</span>
<span class="nc" id="L214">	}</span>

	private void setAdvancedButtons()
	{
<span class="nc" id="L218">		buttonPanel.removeAll();</span>
<span class="nc" id="L219">		buttonPanel.add(saveButton);</span>
<span class="nc" id="L220">		buttonPanel.add(alwaysAdvancedCheck);</span>
<span class="nc" id="L221">		buttonPanel.revalidate();</span>
<span class="nc" id="L222">	}</span>

	/**
	 * Set the selected advanced sources for a particular game mode and
	 * remember them. Overrides existing selections.
	 *
	 * @param sourceSel A selection facade of the sources to set.
	 */
	public void setAdvancedSources(final SourceSelectionFacade sourceSel)
	{
<span class="nc" id="L232">		advancedPanel.setSourceSelection(sourceSel);</span>
<span class="nc" id="L233">		advancedPanel.rememberSelectedSources();</span>
<span class="nc" id="L234">	}</span>

	@Override
	public void stateChanged(ChangeEvent e)
	{
<span class="nc bnc" id="L239" title="All 2 branches missed.">		if (tabs.getSelectedComponent() == basicPanel)</span>
		{
<span class="nc" id="L241">			setBasicButtons();</span>
		}
		else
		{
<span class="nc" id="L245">			setAdvancedButtons();</span>
		}
<span class="nc" id="L247">	}</span>

	@Override
	public void actionPerformed(ActionEvent e)
	{
<span class="nc" id="L252">		String command = e.getActionCommand();</span>
<span class="nc bnc" id="L253" title="All 5 branches missed.">		switch (command)</span>
		{
			case SAVE_COMMAND -&gt; {
<span class="nc" id="L256">				final JList sourcesList = new JList&lt;&gt;();</span>
<span class="nc" id="L257">				final JTextField nameField = new JTextField();</span>
<span class="nc" id="L258">				ListFacade&lt;SourceSelectionFacade&gt; sources = new SortedListFacade&lt;&gt;(</span>
<span class="nc" id="L259">						Comparators.toStringIgnoreCaseCollator(),</span>
<span class="nc" id="L260">						FacadeFactory.getCustomSourceSelections()</span>
				);
<span class="nc" id="L262">				sourcesList.setModel(new FacadeListModel&lt;&gt;(sources));</span>
<span class="nc" id="L263">				sourcesList.addListSelectionListener(lse -&gt; nameField.setText(sourcesList.getSelectedValue()</span>
<span class="nc" id="L264">				                                                                         .toString()));</span>
<span class="nc" id="L265">				JPanel panel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L266">				panel.add(new JScrollPane(sourcesList), BorderLayout.CENTER);</span>
<span class="nc" id="L267">				panel.add(nameField, BorderLayout.SOUTH);</span>
<span class="nc" id="L268">				int ret = JOptionPane.showOptionDialog(this, panel, &quot;Save the source selection as...&quot;,</span>
						JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE, null, null, null
				);
<span class="nc bnc" id="L271" title="All 2 branches missed.">				if (ret == JOptionPane.OK_OPTION)</span>
				{
<span class="nc" id="L273">					String name = nameField.getText();</span>
<span class="nc" id="L274">					List&lt;Campaign&gt; selectedCampaigns = advancedPanel.getSelectedCampaigns();</span>
<span class="nc" id="L275">					GameMode selectedGameMode = advancedPanel.getSelectedGameMode();</span>

<span class="nc" id="L277">					SourceSelectionFacade selection = null;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">					for (SourceSelectionFacade sourceSelectionFacade : sources)</span>
					{
<span class="nc bnc" id="L280" title="All 2 branches missed.">						if (sourceSelectionFacade.toString().equals(name))</span>
						{
<span class="nc" id="L282">							selection = sourceSelectionFacade;</span>
<span class="nc" id="L283">							break;</span>

						}
<span class="nc" id="L286">					}</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">					if (selection == null)</span>
					{
<span class="nc" id="L289">						selection = FacadeFactory.createCustomSourceSelection(name);</span>
					}
<span class="nc" id="L291">					selection.setCampaigns(selectedCampaigns);</span>
<span class="nc" id="L292">					selection.setGameMode(selectedGameMode);</span>
<span class="nc" id="L293">					basicPanel.setSourceSelection(selection);</span>
				}
<span class="nc" id="L295">			}</span>
<span class="nc" id="L296">			case DELETE_COMMAND -&gt; FacadeFactory.deleteCustomSourceSelection(basicPanel.getSourceSelection());</span>
<span class="nc" id="L297">			case LOAD_COMMAND -&gt; fireSourceLoad();</span>
			case INSTALLDATA_COMMAND -&gt; {
				// Swap to the install data dialog.
<span class="nc" id="L300">				setVisible(false);</span>
<span class="nc" id="L301">				DataInstaller di = new DataInstaller();</span>
<span class="nc" id="L302">				di.setVisible(true);</span>
<span class="nc" id="L303">			}</span>
			default -&gt; //must be the cancel command
<span class="nc" id="L305">					setVisible(false);</span>
		}
<span class="nc" id="L307">	}</span>

	private void fireSourceLoad()
	{
		SourceSelectionFacade selection;
<span class="nc bnc" id="L312" title="All 2 branches missed.">		if (tabs.getSelectedComponent() == basicPanel)</span>
		{
<span class="nc" id="L314">			selection = basicPanel.getSourceSelection();</span>
		}
		else
		{
<span class="nc" id="L318">			selection = FacadeFactory.createSourceSelection(advancedPanel.getSelectedGameMode(),</span>
<span class="nc" id="L319">				advancedPanel.getSelectedCampaigns());</span>
		}
<span class="nc bnc" id="L321" title="All 2 branches missed.">		if (selection == null)</span>
		{
<span class="nc" id="L323">			return;</span>
		}
<span class="nc" id="L325">		List&lt;Campaign&gt; campaigns = ListFacades.wrap(selection.getCampaigns());</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">		if (FacadeFactory.passesPrereqs(campaigns))</span>
		{
<span class="nc" id="L328">			setVisible(false);</span>
<span class="nc" id="L329">			frame.loadSourceSelection(selection);</span>
		}
		else
		{
<span class="nc" id="L333">			JOptionPane.showMessageDialog(this, &quot;Some sources have unfulfilled prereqs&quot;, &quot;Cannot Load Selected Sources&quot;,</span>
				JOptionPane.INFORMATION_MESSAGE);
		}
<span class="nc" id="L336">	}</span>

	@Override
	public void setVisible(boolean visible)
	{
<span class="nc bnc" id="L341" title="All 2 branches missed.">		if (visible)</span>
		{
<span class="nc" id="L343">			advancedPanel.refreshDisplay();</span>
		}
		else
		{
<span class="nc" id="L347">			UIPropertyContext.getInstance().setBoolean(UIPropertyContext.SOURCE_USE_BASIC_KEY,</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">				!alwaysAdvancedCheck.isSelected());</span>
		}
<span class="nc" id="L350">		super.setVisible(visible);</span>
<span class="nc" id="L351">	}</span>

	private class QuickSourceSelectionPanel extends JPanel implements ListSelectionListener
	{

		private static final String DEFAULT_SOURCE = &quot;Pathfinder RPG for Players&quot;; //$NON-NLS-1$
		private final JList sourceList;
		private final InfoPane infoPane;
		private final InfoPaneLinkAction linkAction;

		public QuickSourceSelectionPanel()
<span class="nc" id="L362">		{</span>
<span class="nc" id="L363">			sourceList = new JList&lt;&gt;();</span>
<span class="nc" id="L364">			infoPane = new InfoPane(LanguageBundle.getString(&quot;in_src_info&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L365">			linkAction = new InfoPaneLinkAction(infoPane);</span>

<span class="nc" id="L367">			initComponents();</span>
<span class="nc" id="L368">			initDefaults();</span>
<span class="nc" id="L369">		}</span>

		private void initComponents()
		{
<span class="nc" id="L373">			setLayout(new BorderLayout());</span>
<span class="nc" id="L374">			JLabel label = new JLabel(LanguageBundle.getString(&quot;in_qsrc_intro&quot;));</span>
<span class="nc" id="L375">			label.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
<span class="nc" id="L376">			add(label, BorderLayout.NORTH);</span>
<span class="nc" id="L377">			ListFacade&lt;SourceSelectionFacade&gt; sources = new SortedListFacade&lt;&gt;(Comparators.toStringIgnoreCaseCollator(),</span>
<span class="nc" id="L378">				FacadeFactory.getDisplayedSourceSelections());</span>
<span class="nc" id="L379">			sourceList.setModel(new FacadeListModel&lt;&gt;(sources));</span>
<span class="nc" id="L380">			sourceList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L381">			sourceList.setCellRenderer(new SourceListCellRenderer());</span>
<span class="nc" id="L382">			sourceList.addMouseListener(new MouseAdapter()</span>
<span class="nc" id="L383">			{</span>

				@Override
				public void mouseClicked(MouseEvent e)
				{
<span class="nc bnc" id="L388" title="All 2 branches missed.">					if (e.getClickCount() &gt; 1)</span>
					{
<span class="nc" id="L390">						Point p = e.getPoint();</span>
<span class="nc" id="L391">						int index = sourceList.locationToIndex(p);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">						if (sourceList.getCellBounds(index, index).contains(p))</span>
						{
<span class="nc" id="L394">							fireSourceLoad();</span>
						}
					}

<span class="nc" id="L398">				}</span>

			});
<span class="nc" id="L401">			FlippingSplitPane mainPane = new FlippingSplitPane(JSplitPane.HORIZONTAL_SPLIT);</span>
<span class="nc" id="L402">			mainPane.setTopComponent(new JScrollPane(sourceList));</span>

<span class="nc" id="L404">			linkAction.install();</span>
<span class="nc" id="L405">			infoPane.setPreferredSize(new Dimension(800, 150));</span>
<span class="nc" id="L406">			mainPane.setBottomComponent(infoPane);</span>
<span class="nc" id="L407">			add(mainPane, BorderLayout.CENTER);</span>
<span class="nc" id="L408">		}</span>

		private void initDefaults()
		{
<span class="nc" id="L412">			final ListModel sortedModel = sourceList.getModel();</span>
<span class="nc" id="L413">			String defaultSelectedSource = CONTEXT.initProperty(PROP_SELECTED_SOURCE, DEFAULT_SOURCE);</span>
<span class="nc" id="L414">			int index = Collections.binarySearch(new AbstractList&lt;Object&gt;()</span>
<span class="nc" id="L415">			{</span>

				@Override
				public Object get(int idx)
				{
<span class="nc" id="L420">					return sortedModel.getElementAt(idx);</span>
				}

				@Override
				public int size()
				{
<span class="nc" id="L426">					return sortedModel.getSize();</span>
				}

<span class="nc" id="L429">			}, defaultSelectedSource, Comparators.toStringIgnoreCaseCollator());</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">			if (index &gt;= 0)</span>
			{
<span class="nc" id="L432">				sourceList.setSelectedIndex(index);</span>
			}
<span class="nc bnc" id="L434" title="All 2 branches missed.">			else if (sortedModel.getSize() &gt; 0)</span>
			{
<span class="nc" id="L436">				sourceList.setSelectedIndex(0);</span>
			}
<span class="nc" id="L438">			sourceList.addListSelectionListener(this);</span>
<span class="nc" id="L439">		}</span>

		public SourceSelectionFacade getSourceSelection()
		{
<span class="nc" id="L443">			return (SourceSelectionFacade) sourceList.getSelectedValue();</span>
		}

		void setSourceSelection(SourceSelectionFacade source)
		{
<span class="nc" id="L448">			sourceList.setSelectedValue(source, true);</span>
<span class="nc" id="L449">		}</span>

		@Override
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc" id="L454">			SourceSelectionFacade selection = getSourceSelection();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">			if (selection != null)</span>
			{
<span class="nc" id="L457">				CONTEXT.setProperty(PROP_SELECTED_SOURCE, selection.toString());</span>
<span class="nc" id="L458">				makeSourceSelected(selection);</span>
			}
			else
			{
<span class="nc" id="L462">				deleteButton.setEnabled(false);</span>
			}
<span class="nc" id="L464">		}</span>

		/**
		 * Take the necessary action to show the source the currently selected 
		 * source. This assumes that the source list has already been updated, 
		 * either as a default setting, or from a user action. It does not set
		 * the source to be remembered as the last selection as that may 
		 * interfere with startup defaults, so the caller must do that if 
		 * responding to a user action. 
		 * @param selection The sources selected.
		 */
		public void makeSourceSelected(SourceSelectionFacade selection)
		{
<span class="nc" id="L477">			advancedPanel.setSourceSelection(selection);</span>
<span class="nc" id="L478">			deleteButton.setEnabled(selection.isModifiable());</span>
<span class="nc" id="L479">			infoPane.setText(FacadeFactory.getCampaignInfoFactory().getHTMLInfo(selection));</span>
<span class="nc" id="L480">		}</span>

<span class="nc" id="L482">		private class SourceListCellRenderer extends DefaultListCellRenderer</span>
		{

			@Override
			public Component getListCellRendererComponent(JList list, Object value, int index, boolean isSelected,
				boolean cellHasFocus)
			{
<span class="nc" id="L489">				super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);</span>
<span class="nc" id="L490">				setToolTipText(&quot;&quot;);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">				if (value instanceof SourceSelectionFacade selection)</span>
				{
<span class="nc bnc" id="L493" title="All 2 branches missed.">					if (selection.isModifiable())</span>
					{
<span class="nc" id="L495">						setForeground(ColorUtilty.colorToAWTColor(UIPropertyContext.getCustomItemColor()));</span>
					}
<span class="nc bnc" id="L497" title="All 2 branches missed.">					if (selection.getLoadingState() == LoadingState.LOADED_WITH_ERRORS)</span>
					{
<span class="nc" id="L499">						setForeground(Color.LIGHT_GRAY);</span>
<span class="nc" id="L500">						setToolTipText(selection.getLoadingErrorMessage());</span>
					}
				}
<span class="nc" id="L503">				return this;</span>
			}

		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>