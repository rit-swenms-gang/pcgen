<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultsPreferencesPanelController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui3.preferences</a> &gt; <span class="el_source">DefaultsPreferencesPanelController.java</span></div><h1>DefaultsPreferencesPanelController.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2019 (C) Eitan Adler &lt;lists@eitanadler.com&gt;
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 */

package pcgen.gui3.preferences;

import java.io.File;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

import pcgen.core.GameMode;
import pcgen.core.SettingsHandler;
import pcgen.gui2.UIPropertyContext;
import pcgen.gui3.ResettableController;
import pcgen.system.ConfigurationSettings;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.scene.control.ComboBox;

/**
 * The Defaults Panel is responsible for
 * setting various defaults for characters that can be changed
 * on a per character basis, such as experience table, character
 * type, and so on.
 */
<span class="nc" id="L44">public class DefaultsPreferencesPanelController implements ResettableController</span>
{
	private static final String DEFAULT_PREVIEW_SHEET_KEY = &quot;CharacterSheetInfoTab.defaultPreviewSheet.&quot;;
	@FXML
	private ComboBox&lt;String&gt; xpTableCombo;
	@FXML
	private ComboBox&lt;String&gt; characterTypeCombo;
	@FXML
	private ComboBox&lt;String&gt; previewSheetCombo;

	private static List&lt;String&gt; getPreviewDirecoryOptions(GameMode gameMode)
	{
<span class="nc" id="L56">		String previewDir = ConfigurationSettings.getPreviewDir();</span>
<span class="nc" id="L57">		File sheetDir = new File(previewDir, gameMode.getCharSheetDir());</span>
<span class="nc bnc" id="L58" title="All 4 branches missed.">		if (sheetDir.exists() &amp;&amp; sheetDir.isDirectory())</span>
		{
<span class="nc" id="L60">			File[] files = sheetDir.listFiles();</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">			if (files == null)</span>
			{
<span class="nc" id="L63">				return Collections.emptyList();</span>
			}
			else
			{
<span class="nc" id="L67">				return Arrays.stream(files)</span>
<span class="nc" id="L68">				             .map(File::toString)</span>
<span class="nc" id="L69">				             .collect(Collectors.toList());</span>
			}

		}
		else
		{
<span class="nc" id="L75">			return Collections.emptyList();</span>
		}

	}

	@Override
	public void reset()
	{
		/*
		 * much of this data should be driven by a
		 * model and the controller should actually be getting
		 * a observableList to attach.
		 */

<span class="nc" id="L89">		final GameMode gameMode = SettingsHandler.getGameAsProperty().get();</span>

<span class="nc" id="L91">		final String xpTableName = gameMode.getDefaultXPTableName();</span>
<span class="nc" id="L92">		List&lt;String&gt; xpTableNames = gameMode.getXPTableNames();</span>
<span class="nc" id="L93">		ObservableList&lt;String&gt; xpSheetItems =</span>
<span class="nc" id="L94">				FXCollections.observableArrayList(xpTableNames);</span>
<span class="nc" id="L95">		xpTableCombo.setItems(xpSheetItems);</span>
<span class="nc" id="L96">		xpTableCombo.getSelectionModel().select(xpTableName);</span>

<span class="nc" id="L98">		final String characterType = gameMode.getDefaultCharacterType();</span>
<span class="nc" id="L99">		List&lt;String&gt; characterTypes = gameMode.getCharacterTypeList();</span>
<span class="nc" id="L100">		ObservableList&lt;String&gt; characterTypeItems =</span>
<span class="nc" id="L101">				FXCollections.observableArrayList(characterTypes);</span>
<span class="nc" id="L102">		characterTypeCombo.setItems(characterTypeItems);</span>
<span class="nc" id="L103">		characterTypeCombo.getSelectionModel().select(characterType);</span>

<span class="nc" id="L105">		final String previewSheet = UIPropertyContext.getInstance().initProperty(DEFAULT_PREVIEW_SHEET_KEY + gameMode,</span>
<span class="nc" id="L106">				gameMode.getDefaultPreviewSheet());</span>
<span class="nc" id="L107">		ObservableList&lt;String&gt; previewSheetItems =</span>
<span class="nc" id="L108">				FXCollections.observableArrayList(getPreviewDirecoryOptions(gameMode));</span>
<span class="nc" id="L109">		previewSheetCombo.setItems(previewSheetItems);</span>
<span class="nc" id="L110">		previewSheetCombo.getSelectionModel().select(previewSheet);</span>
<span class="nc" id="L111">	}</span>

	@Override
	public void apply()
	{
<span class="nc" id="L116">		final GameMode gameMode = SettingsHandler.getGameAsProperty().get();</span>
<span class="nc" id="L117">		gameMode.setDefaultXPTableName(xpTableCombo.getSelectionModel().getSelectedItem());</span>
<span class="nc" id="L118">		gameMode.setDefaultCharacterType(characterTypeCombo.getSelectionModel().getSelectedItem());</span>
<span class="nc" id="L119">		gameMode.setDefaultPreviewSheet(previewSheetCombo.getSelectionModel().getSelectedItem());</span>

<span class="nc" id="L121">		UIPropertyContext.getInstance().setProperty(DEFAULT_PREVIEW_SHEET_KEY + gameMode.getName(),</span>
<span class="nc" id="L122">				previewSheetCombo.getSelectionModel().getSelectedItem()</span>
		);
<span class="nc" id="L124">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>