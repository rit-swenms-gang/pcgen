<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CollectionMaps.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.util</a> &gt; <span class="el_source">CollectionMaps.java</span></div><h1>CollectionMaps.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2008 (C) Connor Petty &lt;mistercpp2000@gmail.com&gt;
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 */
package pcgen.util;

import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

public final class CollectionMaps
{

	private CollectionMaps()
	{
	}

	private static &lt;T&gt; T createInstance(Class&lt;T&gt; c)
	{
		try
		{
<span class="nc" id="L39">			return c.newInstance();</span>
		}
<span class="nc" id="L41">		catch (Exception ex)</span>
		{
<span class="nc" id="L43">			Logger.getLogger(c.getName()).log(Level.SEVERE, null, ex);</span>
		}
<span class="nc" id="L45">		return null;</span>
	}

	public static &lt;K, V, C extends List&lt;V&gt;&gt; ListMap&lt;K, V, C&gt; createListMap(Class&lt;? extends Map&gt; mapClass,
		Class&lt;? extends List&gt; listClass)
	{
		try
		{
<span class="nc" id="L53">			return new BasicListMap(mapClass, listClass);</span>
		}
<span class="nc" id="L55">		catch (Exception ex)</span>
		{
<span class="nc" id="L57">			Logger.getLogger(CollectionMaps.class.getName()).log(Level.SEVERE, null, ex);</span>
		}
<span class="nc" id="L59">		return null;</span>
	}

	private static final class BasicListMap&lt;K, V, C extends List&lt;V&gt;&gt; extends AbstractListMap&lt;K, V, C&gt;
	{

		private final Map&lt;K, C&gt; map;
		private final Class&lt;C&gt; collectionClass;

		@SuppressWarnings(&quot;unchecked&quot;)
		public BasicListMap(Class&lt;? extends Map&gt; mapClass, Class&lt;C&gt; collectionClass)
			throws InstantiationException, IllegalAccessException
<span class="nc" id="L71">		{</span>
<span class="nc" id="L72">			this.map = mapClass.newInstance();</span>
<span class="nc" id="L73">			this.collectionClass = collectionClass;</span>
<span class="nc" id="L74">		}</span>

		@Override
		public void add(K key, int index, V value)
		{
<span class="nc" id="L79">			C list = get(key);</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">			if (list == null)</span>
			{
<span class="nc" id="L82">				list = createInstance(collectionClass);</span>
<span class="nc" id="L83">				list.add(index, value);</span>
<span class="nc" id="L84">				put(key, list);</span>
			}
			else
			{
<span class="nc" id="L88">				list.add(index, value);</span>
			}
<span class="nc" id="L90">		}</span>

		@Override
		public boolean addAll(K key, Collection&lt;? extends V&gt; values)
		{
<span class="nc" id="L95">			C collection = get(key);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">			if (collection == null)</span>
			{
<span class="nc" id="L98">				collection = createInstance(collectionClass);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">				if (collection.addAll(values))</span>
				{
<span class="nc" id="L101">					put(key, collection);</span>
<span class="nc" id="L102">					return true;</span>
				}
<span class="nc" id="L104">				return false;</span>
			}
<span class="nc" id="L106">			return collection.addAll(values);</span>
		}

		@Override
		public C get(Object key)
		{
<span class="nc" id="L112">			return map.get(key);</span>
		}

		@Override
		public C put(K key, C value)
		{
<span class="nc bnc" id="L118" title="All 2 branches missed.">			if (value == null)</span>
			{
<span class="nc" id="L120">				return remove(key);</span>
			}
<span class="nc" id="L122">			return map.put(key, value);</span>
		}

		@Override
		public Set&lt;Entry&lt;K, C&gt;&gt; entrySet()
		{
<span class="nc" id="L128">			return map.entrySet();</span>
		}

		@Override
		public Set&lt;K&gt; keySet()
		{
<span class="nc" id="L134">			return map.keySet();</span>
		}

		@Override
		public boolean containsKey(Object key)
		{
<span class="nc" id="L140">			return map.containsKey(key);</span>
		}

		@Override
		public void clear()
		{
<span class="nc" id="L146">			map.clear();</span>
<span class="nc" id="L147">		}</span>

		@Override
		public int size()
		{
<span class="nc" id="L152">			return map.size();</span>
		}

		@Override
		public C remove(Object key)
		{
<span class="nc" id="L158">			return map.remove(key);</span>
		}

		@Override
		public V remove(Object key, int index)
		{
<span class="nc" id="L164">			List&lt;V&gt; list = get(key);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">			if (list != null)</span>
			{
<span class="nc" id="L167">				V value = list.remove(index);</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">				if (list.isEmpty())</span>
				{
<span class="nc" id="L170">					remove(key);</span>
				}
<span class="nc" id="L172">				return value;</span>
			}

<span class="nc" id="L175">			return null;</span>
		}

	}

	private static final class BasicCollectionMap&lt;K, V, C extends Collection&lt;V&gt;&gt; extends AbstractCollectionMap&lt;K, V, C&gt;
	{

		private final Map&lt;K, C&gt; map;
		private final Class&lt;C&gt; collectionClass;

		@SuppressWarnings(&quot;unchecked&quot;)
		public BasicCollectionMap(Class&lt;? extends Map&gt; mapClass, Class&lt;C&gt; collectionClass)
			throws InstantiationException, IllegalAccessException
<span class="nc" id="L189">		{</span>
<span class="nc" id="L190">			this.map = mapClass.newInstance();</span>
<span class="nc" id="L191">			this.collectionClass = collectionClass;</span>
<span class="nc" id="L192">		}</span>

		@Override
		public boolean add(K key, V value)
		{
<span class="nc" id="L197">			C collection = get(key);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">			if (collection == null)</span>
			{
<span class="nc" id="L200">				collection = createInstance(collectionClass);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">				if (collection.add(value))</span>
				{
<span class="nc" id="L203">					put(key, collection);</span>
<span class="nc" id="L204">					return true;</span>
				}
<span class="nc" id="L206">				return false;</span>
			}
<span class="nc" id="L208">			return collection.add(value);</span>
		}

		@Override
		public boolean addAll(K key, Collection&lt;? extends V&gt; values)
		{
<span class="nc" id="L214">			C collection = get(key);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			if (collection == null)</span>
			{
<span class="nc" id="L217">				collection = createInstance(collectionClass);</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">				if (collection.addAll(values))</span>
				{
<span class="nc" id="L220">					put(key, collection);</span>
<span class="nc" id="L221">					return true;</span>
				}
<span class="nc" id="L223">				return false;</span>
			}
<span class="nc" id="L225">			return collection.addAll(values);</span>
		}

		@Override
		public C get(Object key)
		{
<span class="nc" id="L231">			return map.get(key);</span>
		}

		@Override
		public C put(K key, C value)
		{
<span class="nc bnc" id="L237" title="All 2 branches missed.">			if (value == null)</span>
			{
<span class="nc" id="L239">				return remove(key);</span>
			}
<span class="nc" id="L241">			return map.put(key, value);</span>
		}

		@Override
		public Set&lt;Entry&lt;K, C&gt;&gt; entrySet()
		{
<span class="nc" id="L247">			return map.entrySet();</span>
		}

		@Override
		public Set&lt;K&gt; keySet()
		{
<span class="nc" id="L253">			return map.keySet();</span>
		}

		@Override
		public boolean containsKey(Object key)
		{
<span class="nc" id="L259">			return map.containsKey(key);</span>
		}

		@Override
		public void clear()
		{
<span class="nc" id="L265">			map.clear();</span>
<span class="nc" id="L266">		}</span>

		@Override
		public int size()
		{
<span class="nc" id="L271">			return map.size();</span>
		}

		@Override
		public C remove(Object key)
		{
<span class="nc" id="L277">			return map.remove(key);</span>
		}

		@Override
		public boolean remove(Object key, Object value)
		{
<span class="nc" id="L283">			C collection = get(key);</span>
<span class="nc bnc" id="L284" title="All 4 branches missed.">			if (collection != null &amp;&amp; collection.remove(value))</span>
			{
<span class="nc bnc" id="L286" title="All 2 branches missed.">				if (collection.isEmpty())</span>
				{
<span class="nc" id="L288">					remove(key);</span>
				}
<span class="nc" id="L290">				return true;</span>
			}
<span class="nc" id="L292">			return false;</span>
		}

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>