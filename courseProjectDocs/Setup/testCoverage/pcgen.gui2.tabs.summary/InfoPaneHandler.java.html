<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InfoPaneHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.tabs.summary</a> &gt; <span class="el_source">InfoPaneHandler.java</span></div><h1>InfoPaneHandler.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2010 Connor Petty &lt;cpmeister@users.sourceforge.net&gt;
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 */
package pcgen.gui2.tabs.summary;

import pcgen.cdom.util.CControl;
import pcgen.core.GameMode;
import pcgen.core.PCStat;
import pcgen.facade.core.CharacterFacade;
import pcgen.facade.core.CharacterLevelFacade;
import pcgen.facade.util.event.ListEvent;
import pcgen.facade.util.event.ListListener;
import pcgen.facade.util.event.ReferenceEvent;
import pcgen.facade.util.event.ReferenceListener;
import pcgen.gui2.tabs.models.HtmlSheetSupport;
import pcgen.gui3.JFXPanelFromResource;
import pcgen.gui3.SimpleHtmlPanelController;
import pcgen.system.LanguageBundle;
import pcgen.util.Logging;

/**
 * Manages the information pane of the summary tab. This is an output sheet 
 * that is displayed in the summary tab to advise the user of important 
 * stats for their character. The output sheet to be displayed is specified in 
 * the game mode miscinfo.lst file using the INFOSHEET tag.
 *    
 */
public class InfoPaneHandler implements ReferenceListener&lt;Object&gt;, ListListener&lt;CharacterLevelFacade&gt;
{

	private final HtmlSheetSupport support;
	private final CharacterFacade character;

	/**
	 * Create a new info pane handler instance for a character.
	 * @param character The character the pane is to display information for.
	 * @param htmlPane the pane that displays the information
	 */
	public InfoPaneHandler(CharacterFacade character, JFXPanelFromResource&lt;SimpleHtmlPanelController&gt; htmlPane)
<span class="nc" id="L55">	{</span>
<span class="nc" id="L56">		this.character = character;</span>
<span class="nc" id="L57">		GameMode game = character.getDataSet().getGameMode();</span>
<span class="nc" id="L58">		support = new HtmlSheetSupport(character, htmlPane, game.getInfoSheet());</span>
<span class="nc" id="L59">		support.setMissingSheetMsg(LanguageBundle.getFormattedString(&quot;in_sumNoInfoSheet&quot;, //$NON-NLS-1$</span>
<span class="nc" id="L60">			character.getDataSet().getGameMode().getName()));</span>
<span class="nc" id="L61">		registerListeners();</span>
<span class="nc" id="L62">	}</span>

	/**
	 * Link this handler with our display component and schedule a refresh of 
	 * the contents for the character. 
	 */
	public void install()
	{
<span class="nc" id="L70">		support.install();</span>
<span class="nc" id="L71">		scheduleRefresh();</span>
<span class="nc" id="L72">	}</span>

	/**
	 * Register with the things we want to be notified of changes about. 
	 */
	private void registerListeners()
	{
<span class="nc bnc" id="L79" title="All 2 branches missed.">		if (character.getRaceRef()==null) </span>
		{
<span class="nc" id="L81">			Logging.debugPrint(&quot;ERROR:getRaceRef is null&quot;);</span>
		} 
		else
		{
<span class="nc" id="L85">		character.getRaceRef().addReferenceListener(this);</span>
		}
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (character.getGenderRef()==null) </span>
		{
<span class="nc" id="L89">			Logging.debugPrint(&quot;ERROR:getGenderRef is null&quot;);</span>
		} 
		else
		{
<span class="nc" id="L93">			character.getGenderRef().addReferenceListener(this);</span>
		}
<span class="nc bnc" id="L95" title="All 4 branches missed.">		if (character.getDataSet()==null || character.getDataSet().getAlignments()==null) </span>
		{
<span class="nc" id="L97">			Logging.debugPrint(&quot;ERROR:getDataSet or getDataSet.getAlignments is null&quot;);</span>
		} 
		else
		{
<span class="nc bnc" id="L101" title="All 2 branches missed.">			if (character.isFeatureEnabled(CControl.ALIGNMENTFEATURE))</span>
			{
<span class="nc" id="L103">				character.getAlignmentRef().addReferenceListener(this);</span>
			}
		}
<span class="nc bnc" id="L106" title="All 2 branches missed.">		for (PCStat stat : character.getDataSet().getStats())</span>
		{
<span class="nc bnc" id="L108" title="All 2 branches missed.">			if (character.getScoreBaseRef(stat)==null) </span>
			{
<span class="nc" id="L110">				Logging.debugPrint(&quot;getScoreBaseRef is null&quot;);</span>
			} 
			else
			{
<span class="nc" id="L114">				character.getScoreBaseRef(stat).addReferenceListener(this);</span>
			}
<span class="nc" id="L116">		}</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">		if (character.getCharacterLevelsFacade()==null)</span>
		{
<span class="nc" id="L119">			Logging.debugPrint(&quot;getCharacterLevelsFacade is null&quot;);</span>
		} 
		else
		{
<span class="nc" id="L123">			character.getCharacterLevelsFacade().addListListener(this);</span>
		}
<span class="nc bnc" id="L125" title="All 2 branches missed.">		if (character.getHandedRef()==null)</span>
		{
<span class="nc" id="L127">			Logging.debugPrint(&quot;getHandedRef is null&quot;);</span>
		} 
		else
		{
<span class="nc" id="L131">			character.getHandedRef().addReferenceListener(this);</span>
		}
<span class="nc bnc" id="L133" title="All 2 branches missed.">		if (character.getAgeRef()==null)</span>
		{
<span class="nc" id="L135">			Logging.debugPrint(&quot;getAgeRef is null&quot;);</span>
		} 
		else
		{
<span class="nc" id="L139">			character.getAgeRef().addReferenceListener(this);</span>
		}
<span class="nc" id="L141">	}</span>
	/**
	 * Start an update of the contents of the info pane for this character. The
	 * update will happen in a new thread and will not be started if one is 
	 * already running.  
	 */
	public void scheduleRefresh()
	{
<span class="nc" id="L149">		support.refresh();</span>
<span class="nc" id="L150">	}</span>

	/**
	 * Register that we are no longer the active character. 
	 */
	public void uninstall()
	{
<span class="nc" id="L157">		support.uninstall();</span>
<span class="nc" id="L158">	}</span>

	@Override
	public void referenceChanged(ReferenceEvent&lt;Object&gt; e)
	{
<span class="nc" id="L163">		scheduleRefresh();</span>
<span class="nc" id="L164">	}</span>

	@Override
	public void elementAdded(ListEvent&lt;CharacterLevelFacade&gt; e)
	{
<span class="nc" id="L169">		scheduleRefresh();</span>
<span class="nc" id="L170">	}</span>

	@Override
	public void elementRemoved(ListEvent&lt;CharacterLevelFacade&gt; e)
	{
<span class="nc" id="L175">		scheduleRefresh();</span>
<span class="nc" id="L176">	}</span>

	@Override
	public void elementModified(ListEvent&lt;CharacterLevelFacade&gt; e)
	{
<span class="nc" id="L181">		scheduleRefresh();</span>
<span class="nc" id="L182">	}</span>

	@Override
	public void elementsChanged(ListEvent&lt;CharacterLevelFacade&gt; e)
	{
<span class="nc" id="L187">		scheduleRefresh();</span>
<span class="nc" id="L188">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>