<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClassInfoTab.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.tabs</a> &gt; <span class="el_source">ClassInfoTab.java</span></div><h1>ClassInfoTab.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2008 Connor Petty &lt;cpmeister@users.sourceforge.net&gt;
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 */
package pcgen.gui2.tabs;

import java.awt.BorderLayout;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.Transferable;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.awt.event.ActionEvent;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.swing.AbstractAction;
import javax.swing.Box;
import javax.swing.JButton;
import javax.swing.JComponent;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.JTable;
import javax.swing.ListSelectionModel;
import javax.swing.SpinnerNumberModel;
import javax.swing.SwingConstants;
import javax.swing.TransferHandler;
import javax.swing.border.EmptyBorder;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.AbstractTableModel;

import pcgen.core.PCClass;
import pcgen.facade.core.CharacterFacade;
import pcgen.facade.core.CharacterLevelFacade;
import pcgen.facade.core.CharacterLevelsFacade;
import pcgen.facade.util.DefaultListFacade;
import pcgen.facade.util.ListFacade;
import pcgen.facade.util.event.ListEvent;
import pcgen.facade.util.event.ListListener;
import pcgen.gui2.filter.Filter;
import pcgen.gui2.filter.FilterBar;
import pcgen.gui2.filter.FilterButton;
import pcgen.gui2.filter.FilteredTreeViewTable;
import pcgen.gui2.filter.SearchFilterPanel;
import pcgen.gui2.tabs.models.CharacterTreeCellRenderer.Handler;
import pcgen.gui2.tabs.models.QualifiedTreeCellRenderer;
import pcgen.gui2.tools.FlippingSplitPane;
import pcgen.gui2.tools.Icons;
import pcgen.gui2.tools.InfoPane;
import pcgen.gui2.util.table.TableUtils;
import pcgen.gui2.util.treeview.DataView;
import pcgen.gui2.util.treeview.DataViewColumn;
import pcgen.gui2.util.treeview.DefaultDataViewColumn;
import pcgen.gui2.util.treeview.TreeView;
import pcgen.gui2.util.treeview.TreeViewModel;
import pcgen.gui2.util.treeview.TreeViewPath;
import pcgen.system.LanguageBundle;
import pcgen.util.enumeration.Tab;

@SuppressWarnings(&quot;serial&quot;)
public class ClassInfoTab extends FlippingSplitPane implements CharacterInfoTab
{

	/**
	 * The table of available classes
	 */
	private final FilteredTreeViewTable&lt;Object, PCClass&gt; availableTable;
	/**
	 * The table of the character's classes
	 */
	private final JTable classTable;
	private final JButton addButton;
	private final JButton removeButton;
	private final TabTitle tabTitle;
	private final InfoPane infoPane;
	private final JSpinner spinner;
	private final FilterButton&lt;Object, PCClass&gt; qFilterButton;
	private final QualifiedTreeCellRenderer qualifiedRenderer;
	private final ClassTransferHandler classTransferHandler;
	private int spinnerValue;

	public ClassInfoTab()
	{
<span class="nc" id="L103">		super();</span>
<span class="nc" id="L104">		this.availableTable = new FilteredTreeViewTable&lt;&gt;();</span>
<span class="nc" id="L105">		this.classTable = TableUtils.createDefaultTable();</span>
<span class="nc" id="L106">		this.addButton = new JButton();</span>
<span class="nc" id="L107">		this.removeButton = new JButton();</span>
<span class="nc" id="L108">		this.tabTitle = new TabTitle(Tab.CLASSES);</span>
<span class="nc" id="L109">		this.infoPane = new InfoPane(LanguageBundle.getString(&quot;in_clInfo&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L110">		this.spinner = new JSpinner(new SpinnerNumberModel(1, 1, 50, 1));</span>
<span class="nc" id="L111">		this.qFilterButton = new FilterButton&lt;&gt;(&quot;ClassQualified&quot;);</span>
<span class="nc" id="L112">		this.qualifiedRenderer = new QualifiedTreeCellRenderer();</span>
<span class="nc" id="L113">		this.classTransferHandler = new ClassTransferHandler();</span>
<span class="nc" id="L114">		initComponents();</span>
<span class="nc" id="L115">	}</span>

	private void initComponents()
	{
<span class="nc" id="L119">		FlippingSplitPane topPane = new FlippingSplitPane();</span>
<span class="nc" id="L120">		setTopComponent(topPane);</span>
<span class="nc" id="L121">		setOrientation(VERTICAL_SPLIT);</span>

<span class="nc" id="L123">		JPanel availPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L124">		FilterBar&lt;Object, PCClass&gt; bar = new FilterBar&lt;&gt;();</span>
<span class="nc" id="L125">		bar.addDisplayableFilter(new SearchFilterPanel());</span>
<span class="nc" id="L126">		qFilterButton.setText(LanguageBundle.getString(&quot;in_igQualFilter&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L127">		bar.addDisplayableFilter(qFilterButton);</span>
<span class="nc" id="L128">		availPanel.add(bar, BorderLayout.NORTH);</span>

<span class="nc" id="L130">		availableTable.setTreeCellRenderer(qualifiedRenderer);</span>
<span class="nc" id="L131">		availableTable.setDisplayableFilter(bar);</span>
<span class="nc" id="L132">		availPanel.add(new JScrollPane(availableTable), BorderLayout.CENTER);</span>
		{
<span class="nc" id="L134">			Box box = Box.createHorizontalBox();</span>
<span class="nc" id="L135">			box.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L136">			spinner.setMaximumSize(spinner.getPreferredSize());</span>
<span class="nc" id="L137">			box.add(spinner);</span>
<span class="nc" id="L138">			box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L139">			addButton.setHorizontalTextPosition(SwingConstants.LEADING);</span>
<span class="nc" id="L140">			box.add(addButton);</span>
<span class="nc" id="L141">			box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L142">			box.setBorder(new EmptyBorder(0, 0, 5, 0));</span>
<span class="nc" id="L143">			availPanel.add(box, BorderLayout.SOUTH);</span>
		}

<span class="nc" id="L146">		topPane.setLeftComponent(availPanel);</span>

<span class="nc" id="L148">		JPanel selPanel = new JPanel(new BorderLayout());</span>

<span class="nc" id="L150">		JScrollPane tablePane = new JScrollPane(classTable);</span>
<span class="nc" id="L151">		selPanel.add(tablePane, BorderLayout.CENTER);</span>
		{
<span class="nc" id="L153">			Box box = Box.createHorizontalBox();</span>
<span class="nc" id="L154">			box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L155">			box.add(removeButton);</span>
<span class="nc" id="L156">			box.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L157">			box.setBorder(new EmptyBorder(0, 0, 5, 0));</span>
<span class="nc" id="L158">			selPanel.add(box, BorderLayout.SOUTH);</span>
		}
		{
<span class="nc" id="L161">			classTable.setDragEnabled(true);</span>
<span class="nc" id="L162">			classTable.setTransferHandler(classTransferHandler);</span>

<span class="nc" id="L164">			availableTable.setDragEnabled(true);</span>
<span class="nc" id="L165">			availableTable.setTransferHandler(classTransferHandler);</span>
		}
<span class="nc" id="L167">		initListeners();</span>

<span class="nc" id="L169">		topPane.setRightComponent(selPanel);</span>
<span class="nc" id="L170">		setBottomComponent(infoPane);</span>
<span class="nc" id="L171">		setResizeWeight(0.75);</span>
<span class="nc" id="L172">	}</span>

	private void initListeners()
	{
<span class="nc" id="L176">		spinner.addChangeListener(e -&gt; spinnerValue = (Integer) spinner.getValue());</span>
<span class="nc" id="L177">		spinnerValue = (Integer) spinner.getValue();</span>
<span class="nc" id="L178">		classTable.getSelectionModel().setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L179">		availableTable.getSelectionModel().setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L180">	}</span>

	@Override
	public ModelMap createModels(CharacterFacade character)
	{
<span class="nc" id="L185">		ModelMap models = new ModelMap();</span>
<span class="nc" id="L186">		models.put(ClassTransferHandler.TransHandler.class, classTransferHandler.createHandler(character));</span>
<span class="nc" id="L187">		models.put(ClassTreeViewModel.class, new ClassTreeViewModel(character));</span>
<span class="nc" id="L188">		models.put(ClassTableModel.class, new ClassTableModel(character));</span>
<span class="nc" id="L189">		models.put(AddClassAction.class, new AddClassAction(character));</span>
<span class="nc" id="L190">		models.put(RemoveClassAction.class, new RemoveClassAction(character));</span>
<span class="nc" id="L191">		models.put(InfoHandler.class, new InfoHandler(character));</span>
<span class="nc" id="L192">		models.put(Handler.class, qualifiedRenderer.createHandler(character));</span>
<span class="nc" id="L193">		models.put(QualifiedFilterHandler.class, new QualifiedFilterHandler(character));</span>
<span class="nc" id="L194">		return models;</span>
	}

	@Override
	public void storeModels(ModelMap models)
	{
<span class="nc" id="L200">		models.get(InfoHandler.class).uninstall();</span>
<span class="nc" id="L201">		models.get(AddClassAction.class).uninstall();</span>
<span class="nc" id="L202">		models.get(Handler.class).uninstall();</span>
<span class="nc" id="L203">		models.get(ClassTransferHandler.TransHandler.class).uninstall();</span>
<span class="nc" id="L204">	}</span>

	@Override
	public void restoreModels(ModelMap models)
	{
<span class="nc" id="L209">		models.get(Handler.class).install();</span>
<span class="nc" id="L210">		models.get(QualifiedFilterHandler.class).install();</span>
<span class="nc" id="L211">		classTable.setModel(models.get(ClassTableModel.class));</span>
<span class="nc" id="L212">		availableTable.setTreeViewModel(models.get(ClassTreeViewModel.class));</span>
<span class="nc" id="L213">		models.get(AddClassAction.class).install();</span>
<span class="nc" id="L214">		models.get(RemoveClassAction.class).install();</span>
<span class="nc" id="L215">		models.get(InfoHandler.class).install();</span>
<span class="nc" id="L216">		models.get(ClassTransferHandler.TransHandler.class).install();</span>
<span class="nc" id="L217">	}</span>

	@Override
	public TabTitle getTabTitle()
	{
<span class="nc" id="L222">		return tabTitle;</span>
	}

	private PCClass getSelectedClass(Object eventSource)
	{
<span class="nc" id="L227">		Object data = null;</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		if (eventSource == availableTable.getSelectionModel())</span>
		{
<span class="nc" id="L230">			data = availableTable.getSelectedObject();</span>
		}
		else
		{
<span class="nc" id="L234">			int selectedRow = classTable.getSelectedRow();</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">			if (selectedRow != -1)</span>
			{
<span class="nc" id="L237">				data = classTable.getModel().getValueAt(selectedRow, 1);</span>
			}
		}
<span class="nc bnc" id="L240" title="All 4 branches missed.">		if (data != null &amp;&amp; data instanceof PCClass)</span>
		{
<span class="nc" id="L242">			return (PCClass) data;</span>
		}
<span class="nc" id="L244">		return null;</span>
	}

	public void addCharacterLevels(CharacterFacade character, PCClass clazz)
	{
<span class="nc bnc" id="L249" title="All 2 branches missed.">		if (clazz != null)</span>
		{
<span class="nc" id="L251">			PCClass[] classes = new PCClass[spinnerValue];</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">			for (int x = 0; x &lt; spinnerValue; x++)</span>
			{
<span class="nc" id="L254">				classes[x] = clazz;</span>
			}
<span class="nc" id="L256">			character.addCharacterLevels(classes);</span>
		}
<span class="nc" id="L258">	}</span>

	private class AddClassAction extends AbstractAction implements ListSelectionListener
	{

		private final CharacterFacade character;
<span class="nc" id="L264">		private PCClass selectedClass = null;</span>

		public AddClassAction(CharacterFacade character)
<span class="nc" id="L267">		{</span>
<span class="nc" id="L268">			super(LanguageBundle.getString(&quot;in_cl_addlevels&quot;));</span>
<span class="nc" id="L269">			this.character = character;</span>
<span class="nc" id="L270">			putValue(SMALL_ICON, Icons.Forward16.getImageIcon());</span>
<span class="nc" id="L271">			setEnabled(false);</span>
<span class="nc" id="L272">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L277">			addCharacterLevels(character, selectedClass);</span>
<span class="nc" id="L278">		}</span>

		public void install()
		{
<span class="nc" id="L282">			addButton.setAction(this);</span>
<span class="nc" id="L283">			availableTable.addActionListener(this);</span>
<span class="nc" id="L284">			availableTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L285">			classTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L286">		}</span>

		public void uninstall()
		{
<span class="nc" id="L290">			availableTable.removeActionListener(this);</span>
<span class="nc" id="L291">			availableTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L292">			classTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L293">		}</span>

		@Override
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc bnc" id="L298" title="All 2 branches missed.">			if (!e.getValueIsAdjusting())</span>
			{
<span class="nc" id="L300">				selectedClass = getSelectedClass(e.getSource());</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">				if (selectedClass == null)</span>
				{
<span class="nc" id="L303">					setEnabled(false);</span>
				}
<span class="nc bnc" id="L305" title="All 2 branches missed.">				setEnabled(selectedClass != null);</span>
			}
<span class="nc" id="L307">		}</span>

	}

	private class RemoveClassAction extends AbstractAction implements ListListener&lt;CharacterLevelFacade&gt;
	{

		private final CharacterFacade character;

		public RemoveClassAction(CharacterFacade character)
<span class="nc" id="L317">		{</span>
<span class="nc" id="L318">			super(LanguageBundle.getString(&quot;in_cl_removelevels&quot;));</span>
<span class="nc" id="L319">			this.character = character;</span>
<span class="nc" id="L320">			putValue(SMALL_ICON, Icons.Back16.getImageIcon());</span>
<span class="nc" id="L321">			setEnabled(false);</span>
<span class="nc" id="L322">			character.getCharacterLevelsFacade().addListListener(this);</span>
<span class="nc" id="L323">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L328">			character.removeCharacterLevels(1);</span>
<span class="nc" id="L329">		}</span>

		public void install()
		{
<span class="nc" id="L333">			removeButton.setAction(this);</span>
<span class="nc" id="L334">		}</span>

		private void checkEnabled()
		{
<span class="nc bnc" id="L338" title="All 2 branches missed.">			setEnabled(!character.getCharacterLevelsFacade().isEmpty());</span>
<span class="nc" id="L339">		}</span>

		@Override
		public void elementAdded(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L344">			checkEnabled();</span>
<span class="nc" id="L345">		}</span>

		@Override
		public void elementRemoved(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L350">			checkEnabled();</span>
<span class="nc" id="L351">		}</span>

		@Override
		public void elementsChanged(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L356">			checkEnabled();</span>
<span class="nc" id="L357">		}</span>

		@Override
		public void elementModified(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
			//Do nothing
<span class="nc" id="L363">		}</span>
	}

<span class="nc" id="L366">	private final class ClassTransferHandler extends TransferHandler</span>
	{

<span class="nc" id="L369">		private final DataFlavor classFlavor =</span>
				new DataFlavor(
					DataFlavor.javaJVMLocalObjectMimeType
<span class="nc" id="L372">					+ &quot;;class=&quot; + PCClass.class.getName(), null); //$NON-NLS-1$</span>

<span class="nc" id="L374">		private CharacterFacade character = null;</span>

		public void setCharacter(CharacterFacade character)
		{
<span class="nc" id="L378">			this.character = character;</span>
<span class="nc" id="L379">		}</span>

		public TransHandler createHandler(CharacterFacade character)
		{
<span class="nc" id="L383">			return new TransHandler(character);</span>
		}

		private class TransHandler
		{

			private final CharacterFacade character;

			public TransHandler(CharacterFacade character)
<span class="nc" id="L392">			{</span>
<span class="nc" id="L393">				this.character = character;</span>
<span class="nc" id="L394">			}</span>

			public void install()
			{
<span class="nc" id="L398">				setCharacter(character);</span>
<span class="nc" id="L399">			}</span>

			public void uninstall()
			{
<span class="nc" id="L403">				setCharacter(null);</span>
<span class="nc" id="L404">			}</span>
		}

		@Override
		public int getSourceActions(JComponent c)
		{
<span class="nc bnc" id="L410" title="All 2 branches missed.">			if (c == classTable)</span>
			{
<span class="nc" id="L412">				return NONE;</span>
			}
			else
			{
<span class="nc" id="L416">				return COPY;</span>
			}
		}

		@Override
		protected Transferable createTransferable(JComponent c)
		{
<span class="nc" id="L423">			final PCClass selClass = getSelectedClass(availableTable);</span>

<span class="nc bnc" id="L425" title="All 2 branches missed.">			if (selClass == null)</span>
			{
<span class="nc" id="L427">				return null;</span>
			}
<span class="nc" id="L429">			return new Transferable()</span>
<span class="nc" id="L430">			{</span>

				@Override
				public DataFlavor[] getTransferDataFlavors()
				{
<span class="nc" id="L435">					return new DataFlavor[]{classFlavor};</span>
				}

				@Override
				public boolean isDataFlavorSupported(DataFlavor flavor)
				{
<span class="nc bnc" id="L441" title="All 2 branches missed.">					return classFlavor == flavor;</span>
				}

				@Override
				public Object getTransferData(DataFlavor flavor) throws UnsupportedFlavorException
				{
<span class="nc bnc" id="L447" title="All 2 branches missed.">					if (!isDataFlavorSupported(flavor))</span>
					{
<span class="nc" id="L449">						throw new UnsupportedFlavorException(flavor);</span>
					}
<span class="nc" id="L451">					return selClass;</span>
				}

			};
		}

		@Override
		public boolean canImport(JComponent comp, DataFlavor[] transferFlavors)
		{
<span class="nc bnc" id="L460" title="All 2 branches missed.">			return transferFlavors[0] == classFlavor;</span>
		}

		@Override
		public boolean importData(JComponent comp, Transferable t)
		{
<span class="nc bnc" id="L466" title="All 2 branches missed.">			if (comp == classTable)</span>
			{
				try
				{
<span class="nc" id="L470">					PCClass c = (PCClass) t.getTransferData(classFlavor);</span>
<span class="nc" id="L471">					addCharacterLevels(character, c);</span>
<span class="nc" id="L472">					return true;</span>
				}
<span class="nc" id="L474">				catch (UnsupportedFlavorException | IOException ex)</span>
				{
<span class="nc" id="L476">					Logger.getLogger(ClassTransferHandler.class.getName()).log(Level.SEVERE, null, ex);</span>
				}
<span class="nc" id="L478">				return false;</span>
			}
<span class="nc" id="L480">			return true;</span>
		}

	}

	private class QualifiedFilterHandler implements Filter&lt;Object, PCClass&gt;
	{

		private final CharacterFacade character;

		public QualifiedFilterHandler(CharacterFacade character)
<span class="nc" id="L491">		{</span>
<span class="nc" id="L492">			this.character = character;</span>
<span class="nc" id="L493">		}</span>

		public void install()
		{
<span class="nc" id="L497">			qFilterButton.setFilter(this);</span>
<span class="nc" id="L498">		}</span>

		@Override
		public boolean accept(Object context, PCClass element)
		{
<span class="nc" id="L503">			return character.isQualifiedFor(element);</span>
		}

	}

	private static class ClassTreeViewModel implements TreeViewModel&lt;PCClass&gt;, DataView&lt;PCClass&gt;
	{

<span class="nc" id="L511">		private static final List&lt;DefaultDataViewColumn&gt; COLUMNS =</span>
<span class="nc" id="L512">				Arrays.asList(new DefaultDataViewColumn(&quot;in_clInfoHD&quot;, String.class), //$NON-NLS-1$</span>
					new DefaultDataViewColumn(&quot;in_clInfoType&quot;, String.class, true), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_descrip&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_baseStat&quot;, String.class), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_spellType&quot;, String.class), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_source&quot;, String.class)); //$NON-NLS-1$
<span class="nc" id="L518">		private static final ListFacade&lt;? extends TreeView&lt;PCClass&gt;&gt; TREE_VIEWS =</span>
<span class="nc" id="L519">				new DefaultListFacade&lt;&gt;(Arrays.asList(ClassTreeView.values()));</span>
		private final CharacterFacade character;

		public ClassTreeViewModel(CharacterFacade character)
<span class="nc" id="L523">		{</span>
<span class="nc" id="L524">			this.character = character;</span>
<span class="nc" id="L525">		}</span>

		@Override
		public String getPrefsKey()
		{
<span class="nc" id="L530">			return &quot;ClassTree&quot;; //$NON-NLS-1$</span>
		}

		@Override
		public ListFacade&lt;? extends TreeView&lt;PCClass&gt;&gt; getTreeViews()
		{
<span class="nc" id="L536">			return TREE_VIEWS;</span>
		}

		@Override
		public int getDefaultTreeViewIndex()
		{
<span class="nc" id="L542">			return 0;</span>
		}

		@Override
		public DataView&lt;PCClass&gt; getDataView()
		{
<span class="nc" id="L548">			return this;</span>
		}

		@Override
		public ListFacade&lt;PCClass&gt; getDataModel()
		{
<span class="nc" id="L554">			return character.getDataSet().getClasses();</span>
		}

		@Override
		public Object getData(PCClass obj, int column)
		{
<span class="nc bnc" id="L560" title="All 7 branches missed.">			return switch (column)</span>
					{
<span class="nc" id="L562">						case 0 -&gt; obj.getHD();</span>
<span class="nc" id="L563">						case 1 -&gt; getTypes(obj);</span>
<span class="nc" id="L564">						case 2 -&gt; character.getInfoFactory().getDescription(obj);</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">						case 3 -&gt; &quot;None&quot;.equals(obj.getBaseStat()) ? &quot;&quot; : obj.getBaseStat(); //$NON-NLS-1$</span>
						// $NON-NLS-2$
<span class="nc" id="L567">						case 4 -&gt; obj.getSpellType();</span>
<span class="nc" id="L568">						case 5 -&gt; obj.getSource();</span>
<span class="nc" id="L569">						default -&gt; null;</span>
					};
		}

		@Override
		public void setData(Object value, PCClass element, int column)
		{
<span class="nc" id="L576">		}</span>

		private String getTypes(PCClass obj)
		{
<span class="nc" id="L580">			StringBuilder ret = new StringBuilder(); //$NON-NLS-1$</span>
<span class="nc" id="L581">			String[] types = obj.getTypes();</span>
<span class="nc bnc" id="L582" title="All 4 branches missed.">			if (types != null &amp;&amp; types.length &gt; 0)</span>
			{
<span class="nc" id="L584">				ret.append(types[0]);</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">				for (int x = 1; x &lt; types.length; x++)</span>
				{
<span class="nc" id="L587">					ret.append(&quot;, &quot;).append(types[x]); //$NON-NLS-1$</span>
				}
			}
<span class="nc" id="L590">			return ret.toString();</span>
		}

		@Override
		public List&lt;? extends DataViewColumn&gt; getDataColumns()
		{
<span class="nc" id="L596">			return COLUMNS;</span>
		}

<span class="nc" id="L599">		private static enum ClassTreeView implements TreeView&lt;PCClass&gt;</span>
		{

<span class="nc" id="L602">			NAME(&quot;in_nameLabel&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L603">			TYPE_NAME(&quot;in_typeName&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L604">			SOURCE_NAME(&quot;in_sourceName&quot;); //$NON-NLS-1$</span>
			private final String name;

			private ClassTreeView(String nameKey)
<span class="nc" id="L608">			{</span>
<span class="nc" id="L609">				this.name = LanguageBundle.getString(nameKey);</span>
<span class="nc" id="L610">			}</span>

			@Override
			public String getViewName()
			{
<span class="nc" id="L615">				return name;</span>
			}

			@Override
			public List&lt;TreeViewPath&lt;PCClass&gt;&gt; getPaths(PCClass pobj)
			{
<span class="nc bnc" id="L621" title="All 4 branches missed.">				switch (this)</span>
				{
					case TYPE_NAME:
<span class="nc" id="L624">						String[] types = pobj.getTypes();</span>
<span class="nc bnc" id="L625" title="All 4 branches missed.">						if (types != null &amp;&amp; types.length &gt; 0)</span>
						{
<span class="nc" id="L627">							List&lt;TreeViewPath&lt;PCClass&gt;&gt; paths = new ArrayList&lt;&gt;(types.length);</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">							for (String type : types)</span>
							{
<span class="nc" id="L630">								paths.add(new TreeViewPath&lt;&gt;(pobj, type));</span>
							}
<span class="nc" id="L632">							return paths;</span>
						}
					case NAME:
<span class="nc" id="L635">						return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj));</span>
					case SOURCE_NAME:
<span class="nc" id="L637">						return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj, pobj.getSourceForNodeDisplay()));</span>
					default:
<span class="nc" id="L639">						throw new InternalError();</span>
				}
			}
		}
	}

	private static class ClassTableModel extends AbstractTableModel implements ListListener&lt;CharacterLevelFacade&gt;
	{

<span class="nc" id="L648">		private static final String[] COLUMNS = {LanguageBundle.getString(&quot;in_level&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L649">			LanguageBundle.getString(&quot;in_class&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L650">			LanguageBundle.getString(&quot;in_source&quot;) //$NON-NLS-1$</span>
		};
		private final CharacterLevelsFacade model;

		public ClassTableModel(CharacterFacade character)
<span class="nc" id="L655">		{</span>
<span class="nc" id="L656">			this.model = character.getCharacterLevelsFacade();</span>
<span class="nc" id="L657">			model.addListListener(this);</span>
<span class="nc" id="L658">		}</span>

		@Override
		public int getRowCount()
		{
<span class="nc" id="L663">			return model.getSize();</span>
		}

		@Override
		public int getColumnCount()
		{
<span class="nc" id="L669">			return 3;</span>
		}

		@Override
		public String getColumnName(int column)
		{
<span class="nc" id="L675">			return COLUMNS[column];</span>
		}

		@Override
		public Class&lt;?&gt; getColumnClass(int columnIndex)
		{
<span class="nc bnc" id="L681" title="All 4 branches missed.">			switch (columnIndex)</span>
			{
				case 0:
<span class="nc" id="L684">					return Integer.class;</span>
				case 1:
<span class="nc" id="L686">					return Object.class;</span>
				case 2:
<span class="nc" id="L688">					return String.class;</span>
				default:
					//Case not caught, should this cause an error?
					break;
			}
<span class="nc" id="L693">			return null;</span>
		}

		@Override
		public Object getValueAt(int rowIndex, int columnIndex)
		{
<span class="nc bnc" id="L699" title="All 2 branches missed.">			if (columnIndex == 0)</span>
			{
<span class="nc" id="L701">				return rowIndex + 1;</span>
			}
<span class="nc" id="L703">			PCClass c = model.getClassTaken(model.getElementAt(rowIndex));</span>
<span class="nc bnc" id="L704" title="All 3 branches missed.">			return switch (columnIndex)</span>
					{
<span class="nc" id="L706">						case 1 -&gt; c;</span>
<span class="nc" id="L707">						case 2 -&gt; c.getSource();</span>
<span class="nc" id="L708">						default -&gt; null;</span>
					};
		}

		@Override
		public void elementAdded(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L715">			fireTableRowsInserted(e.getIndex(), e.getIndex());</span>
<span class="nc" id="L716">		}</span>

		@Override
		public void elementRemoved(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L721">			fireTableRowsDeleted(e.getIndex(), e.getIndex());</span>
<span class="nc" id="L722">		}</span>

		@Override
		public void elementsChanged(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L727">			fireTableRowsUpdated(0, getRowCount() - 1);</span>
<span class="nc" id="L728">		}</span>

		@Override
		public void elementModified(ListEvent&lt;CharacterLevelFacade&gt; e)
		{
<span class="nc" id="L733">			fireTableRowsUpdated(e.getIndex(), e.getIndex());</span>
<span class="nc" id="L734">		}</span>

	}

	private class InfoHandler implements ListSelectionListener
	{

		private final CharacterFacade character;
		private String text;

		public InfoHandler(CharacterFacade character)
<span class="nc" id="L745">		{</span>
<span class="nc" id="L746">			this.character = character;</span>
<span class="nc" id="L747">			this.text = &quot;&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L748">		}</span>

		public void install()
		{
<span class="nc" id="L752">			classTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L753">			availableTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L754">			infoPane.setText(text);</span>
<span class="nc" id="L755">		}</span>

		public void uninstall()
		{
<span class="nc" id="L759">			classTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L760">			availableTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L761">		}</span>

		@Override
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc bnc" id="L766" title="All 2 branches missed.">			if (!e.getValueIsAdjusting())</span>
			{
<span class="nc" id="L768">				PCClass data = getSelectedClass(e.getSource());</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">				if (data != null)</span>
				{
<span class="nc" id="L771">					text = character.getInfoFactory().getHTMLInfo(data, null);</span>
<span class="nc" id="L772">					infoPane.setText(text);</span>
				}
				else
				{
<span class="nc" id="L776">					text = &quot;&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L777">					infoPane.setText(&quot;&quot;); //$NON-NLS-1$</span>
				}
			}
<span class="nc" id="L780">		}</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>