<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RaceInfoTab.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.tabs</a> &gt; <span class="el_source">RaceInfoTab.java</span></div><h1>RaceInfoTab.java</h1><pre class="source lang-java linenums">/**
 * RaceInfoTab.java Copyright James Dempsey, 2010
 *
 * This library is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 *
 * This library is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this library; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 */
package pcgen.gui2.tabs;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

import javax.swing.AbstractAction;
import javax.swing.Box;
import javax.swing.JButton;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.ListSelectionModel;
import javax.swing.SwingConstants;
import javax.swing.border.EmptyBorder;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

import pcgen.cdom.enumeration.ListKey;
import pcgen.cdom.enumeration.ObjectKey;
import pcgen.cdom.enumeration.RaceSubType;
import pcgen.cdom.enumeration.RaceType;
import pcgen.core.Race;
import pcgen.facade.core.CharacterFacade;
import pcgen.facade.core.InfoFactory;
import pcgen.facade.util.DefaultListFacade;
import pcgen.facade.util.ListFacade;
import pcgen.gui2.facade.DelegatingSingleton;
import pcgen.gui2.filter.Filter;
import pcgen.gui2.filter.FilterBar;
import pcgen.gui2.filter.FilterButton;
import pcgen.gui2.filter.FilteredTreeViewTable;
import pcgen.gui2.filter.SearchFilterPanel;
import pcgen.gui2.tabs.models.CharacterTreeCellRenderer.Handler;
import pcgen.gui2.tabs.models.QualifiedTreeCellRenderer;
import pcgen.gui2.tools.FlippingSplitPane;
import pcgen.gui2.tools.Icons;
import pcgen.gui2.tools.InfoPane;
import pcgen.gui2.util.treeview.CachedDataView;
import pcgen.gui2.util.treeview.DataView;
import pcgen.gui2.util.treeview.DataViewColumn;
import pcgen.gui2.util.treeview.DefaultDataViewColumn;
import pcgen.gui2.util.treeview.TreeView;
import pcgen.gui2.util.treeview.TreeViewModel;
import pcgen.gui2.util.treeview.TreeViewPath;
import pcgen.system.LanguageBundle;
import pcgen.util.enumeration.Tab;

/**
 * The Class {@code RaceInfoTab} is the component used in the Race tab.
 */
public final class RaceInfoTab extends FlippingSplitPane implements CharacterInfoTab
{

<span class="nc" id="L75">	private static final TabTitle TITLE = new TabTitle(Tab.RACE);</span>
	private final FilteredTreeViewTable&lt;Object, Race&gt; raceTable;
	private final FilteredTreeViewTable&lt;Object, Race&gt; selectedTable;
	private final InfoPane infoPane;
	private final JButton selectRaceButton;
	private final JButton removeButton;
	private final FilterButton&lt;Object, Race&gt; qFilterButton;
	private final FilterButton&lt;Object, Race&gt; noRacialHdFilterButton;
	private final QualifiedTreeCellRenderer qualifiedRenderer;

	RaceInfoTab()
<span class="nc" id="L86">	{</span>
<span class="nc" id="L87">		this.raceTable = new FilteredTreeViewTable&lt;&gt;();</span>
<span class="nc" id="L88">		this.selectedTable = new FilteredTreeViewTable&lt;&gt;();</span>
<span class="nc" id="L89">		this.infoPane = new InfoPane(LanguageBundle.getString(&quot;in_irRaceInfo&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L90">		this.selectRaceButton = new JButton();</span>
<span class="nc" id="L91">		this.removeButton = new JButton();</span>
<span class="nc" id="L92">		this.qFilterButton = new FilterButton&lt;&gt;(&quot;RaceQualified&quot;);</span>
<span class="nc" id="L93">		this.noRacialHdFilterButton = new FilterButton&lt;&gt;(&quot;RaceNoHD&quot;);</span>
<span class="nc" id="L94">		this.qualifiedRenderer = new QualifiedTreeCellRenderer();</span>

<span class="nc" id="L96">		FlippingSplitPane topPane = new FlippingSplitPane();</span>
<span class="nc" id="L97">		setTopComponent(topPane);</span>
<span class="nc" id="L98">		setOrientation(VERTICAL_SPLIT);</span>

<span class="nc" id="L100">		JPanel availPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L101">		FilterBar&lt;Object, Race&gt; bar = new FilterBar&lt;&gt;();</span>
<span class="nc" id="L102">		bar.addDisplayableFilter(new SearchFilterPanel());</span>
<span class="nc" id="L103">		noRacialHdFilterButton.setText(LanguageBundle.getString(&quot;in_irNoRacialHd&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L104">		noRacialHdFilterButton.setToolTipText(LanguageBundle.getString(&quot;in_irNoRacialHdTip&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L105">		bar.addDisplayableFilter(noRacialHdFilterButton);</span>
<span class="nc" id="L106">		qFilterButton.setText(LanguageBundle.getString(&quot;in_igQualFilter&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L107">		bar.addDisplayableFilter(qFilterButton);</span>
<span class="nc" id="L108">		raceTable.setDisplayableFilter(bar);</span>
<span class="nc" id="L109">		availPanel.add(bar, BorderLayout.NORTH);</span>

<span class="nc" id="L111">		raceTable.getSelectionModel().setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L112">		raceTable.setTreeCellRenderer(qualifiedRenderer);</span>
<span class="nc" id="L113">		availPanel.add(new JScrollPane(raceTable), BorderLayout.CENTER);</span>

<span class="nc" id="L115">		Box box = Box.createHorizontalBox();</span>
<span class="nc" id="L116">		box.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L117">		selectRaceButton.setHorizontalTextPosition(SwingConstants.LEADING);</span>

<span class="nc" id="L119">		box.add(selectRaceButton);</span>
<span class="nc" id="L120">		box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L121">		box.setBorder(new EmptyBorder(0, 0, 5, 0));</span>
<span class="nc" id="L122">		availPanel.add(box, BorderLayout.SOUTH);</span>

<span class="nc" id="L124">		topPane.setLeftComponent(availPanel);</span>

<span class="nc" id="L126">		JPanel selPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L127">		FilterBar&lt;Object, Race&gt; filterBar = new FilterBar&lt;&gt;();</span>
<span class="nc" id="L128">		filterBar.addDisplayableFilter(new SearchFilterPanel());</span>

<span class="nc" id="L130">		selectedTable.setDisplayableFilter(filterBar);</span>
<span class="nc" id="L131">		selectedTable.setTreeCellRenderer(qualifiedRenderer);</span>
<span class="nc" id="L132">		JScrollPane scrollPane = new JScrollPane(selectedTable);</span>
<span class="nc" id="L133">		selPanel.add(scrollPane, BorderLayout.CENTER);</span>
<span class="nc" id="L134">		scrollPane.setPreferredSize(new Dimension(0, 0));</span>

<span class="nc" id="L136">		box = Box.createHorizontalBox();</span>
<span class="nc" id="L137">		box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L138">		box.add(removeButton);</span>
<span class="nc" id="L139">		box.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L140">		box.setBorder(new EmptyBorder(0, 0, 5, 0));</span>
<span class="nc" id="L141">		selPanel.add(box, BorderLayout.SOUTH);</span>

<span class="nc" id="L143">		topPane.setRightComponent(selPanel);</span>
<span class="nc" id="L144">		topPane.setResizeWeight(0.75);</span>

<span class="nc" id="L146">		setBottomComponent(infoPane);</span>
<span class="nc" id="L147">		setResizeWeight(0.75);</span>
<span class="nc" id="L148">	}</span>

	@Override
	public ModelMap createModels(CharacterFacade character)
	{
<span class="nc" id="L153">		ModelMap models = new ModelMap();</span>
<span class="nc" id="L154">		models.put(SelectRaceAction.class, new SelectRaceAction(character));</span>
<span class="nc" id="L155">		models.put(RemoveRaceAction.class, new RemoveRaceAction(character));</span>
<span class="nc" id="L156">		models.put(TreeViewModelHandler.class, new TreeViewModelHandler(character));</span>
<span class="nc" id="L157">		models.put(InfoHandler.class, new InfoHandler(character));</span>
<span class="nc" id="L158">		models.put(Handler.class, qualifiedRenderer.createHandler(character));</span>
<span class="nc" id="L159">		models.put(QualifiedFilterHandler.class, new QualifiedFilterHandler(character));</span>
<span class="nc" id="L160">		models.put(NoRacialHdFilterHandler.class, new NoRacialHdFilterHandler(character));</span>
<span class="nc" id="L161">		return models;</span>
	}

	@Override
	public void restoreModels(ModelMap models)
	{
<span class="nc" id="L167">		raceTable.clearSelection();</span>
<span class="nc" id="L168">		models.get(QualifiedFilterHandler.class).install();</span>
<span class="nc" id="L169">		models.get(NoRacialHdFilterHandler.class).install();</span>
<span class="nc" id="L170">		models.get(Handler.class).install();</span>
<span class="nc" id="L171">		models.get(TreeViewModelHandler.class).install();</span>
<span class="nc" id="L172">		models.get(InfoHandler.class).install();</span>
<span class="nc" id="L173">		models.get(SelectRaceAction.class).install();</span>
<span class="nc" id="L174">		models.get(RemoveRaceAction.class).install();</span>
<span class="nc" id="L175">	}</span>

	@Override
	public void storeModels(ModelMap models)
	{
<span class="nc" id="L180">		models.get(InfoHandler.class).uninstall();</span>
<span class="nc" id="L181">		models.get(SelectRaceAction.class).uninstall();</span>
<span class="nc" id="L182">		models.get(RemoveRaceAction.class).uninstall();</span>
<span class="nc" id="L183">		models.get(Handler.class).uninstall();</span>
<span class="nc" id="L184">	}</span>

	@Override
	public TabTitle getTabTitle()
	{
<span class="nc" id="L189">		return TITLE;</span>
	}

	private final class InfoHandler implements ListSelectionListener
	{

		private final CharacterFacade character;
		private String text;

		private InfoHandler(CharacterFacade character)
<span class="nc" id="L199">		{</span>
<span class="nc" id="L200">			this.character = character;</span>
<span class="nc" id="L201">			this.text = &quot;&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L202">		}</span>

		public void install()
		{
<span class="nc" id="L206">			raceTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L207">			selectedTable.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L208">			infoPane.setText(text);</span>
<span class="nc" id="L209">		}</span>

		public void uninstall()
		{
<span class="nc" id="L213">			raceTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L214">			selectedTable.getSelectionModel().removeListSelectionListener(this);</span>
<span class="nc" id="L215">		}</span>

		@Override
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc bnc" id="L220" title="All 2 branches missed.">			if (!e.getValueIsAdjusting())</span>
			{
<span class="nc" id="L222">				Object obj = null;</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">				if (e.getSource() == raceTable.getSelectionModel())</span>
				{
<span class="nc" id="L225">					int selectedRow = raceTable.getSelectedRow();</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">					if (selectedRow != -1)</span>
					{
<span class="nc" id="L228">						obj = raceTable.getModel().getValueAt(selectedRow, 0);</span>
					}
<span class="nc" id="L230">				}</span>
				else
				{
<span class="nc" id="L233">					int selectedRow = selectedTable.getSelectedRow();</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">					if (selectedRow != -1)</span>
					{
<span class="nc" id="L236">						obj = selectedTable.getModel().getValueAt(selectedRow, 0);</span>
					}
				}
<span class="nc bnc" id="L239" title="All 2 branches missed.">				if (obj instanceof Race)</span>
				{
<span class="nc" id="L241">					text = character.getInfoFactory().getHTMLInfo((Race) obj);</span>
<span class="nc" id="L242">					infoPane.setText(text);</span>
				}
				else
				{
<span class="nc" id="L246">					text = &quot;&quot;;</span>
<span class="nc" id="L247">					infoPane.setText(text);</span>
				}
			}
<span class="nc" id="L250">		}</span>

	}

	private final class SelectRaceAction extends AbstractAction
	{

		private final CharacterFacade character;

		private SelectRaceAction(CharacterFacade character)
<span class="nc" id="L260">		{</span>
<span class="nc" id="L261">			super(LanguageBundle.getString(&quot;in_irSelectRace&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L262">			this.character = character;</span>
<span class="nc" id="L263">			putValue(SMALL_ICON, Icons.Forward16.getImageIcon());</span>
<span class="nc" id="L264">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L269">			Object obj = raceTable.getSelectedObject();</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">			if (obj instanceof Race)</span>
			{
<span class="nc" id="L272">				character.setRace((Race) obj);</span>
			}
<span class="nc" id="L274">		}</span>

		public void install()
		{
<span class="nc" id="L278">			raceTable.addActionListener(this);</span>
<span class="nc" id="L279">			selectRaceButton.setAction(this);</span>
<span class="nc" id="L280">		}</span>

		public void uninstall()
		{
<span class="nc" id="L284">			raceTable.removeActionListener(this);</span>
<span class="nc" id="L285">		}</span>

	}

	private final class RemoveRaceAction extends AbstractAction
	{

		private final CharacterFacade character;

		private RemoveRaceAction(CharacterFacade character)
<span class="nc" id="L295">		{</span>
<span class="nc" id="L296">			super(LanguageBundle.getString(&quot;in_irUnselectRace&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L297">			this.character = character;</span>
<span class="nc" id="L298">			putValue(SMALL_ICON, Icons.Back16.getImageIcon());</span>
<span class="nc" id="L299">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L304">			character.setRace(null);</span>
<span class="nc" id="L305">		}</span>

		public void install()
		{
<span class="nc" id="L309">			selectedTable.addActionListener(this);</span>
<span class="nc" id="L310">			removeButton.setAction(this);</span>
<span class="nc" id="L311">		}</span>

		public void uninstall()
		{
<span class="nc" id="L315">			selectedTable.removeActionListener(this);</span>
<span class="nc" id="L316">		}</span>

	}

	/**
	 * The Class {@code NoRacialHdFilterHandler} provides the filter
	 * backing the No Racial HD filter button.
	 */
	private final class NoRacialHdFilterHandler implements Filter&lt;Object, Race&gt;
	{

		private final InfoFactory infoFactory;

		private NoRacialHdFilterHandler(CharacterFacade character)
<span class="nc" id="L330">		{</span>
<span class="nc" id="L331">			this.infoFactory = character.getInfoFactory();</span>
<span class="nc" id="L332">		}</span>

		public void install()
		{
<span class="nc" id="L336">			noRacialHdFilterButton.setFilter(this);</span>
<span class="nc" id="L337">		}</span>

		@Override
		public boolean accept(Object context, Race element)
		{
<span class="nc bnc" id="L342" title="All 2 branches missed.">			return infoFactory.getNumMonsterClassLevels(element) == 0;</span>
		}

	}

	/**
	 * The Class {@code QualifiedFilterHandler} provides the filter backing
	 * the Qualified filter button.
	 */
	private final class QualifiedFilterHandler implements Filter&lt;Object, Race&gt;
	{

		private final CharacterFacade character;

		private QualifiedFilterHandler(CharacterFacade character)
<span class="nc" id="L357">		{</span>
<span class="nc" id="L358">			this.character = character;</span>
<span class="nc" id="L359">		}</span>

		public void install()
		{
<span class="nc" id="L363">			qFilterButton.setFilter(this);</span>
<span class="nc" id="L364">		}</span>

		@Override
		public boolean accept(Object context, Race element)
		{
<span class="nc" id="L369">			return character.isQualifiedFor(element);</span>
		}

	}

	private final class TreeViewModelHandler
	{

		private final RaceDataView availableView;
		private final RaceDataView selectedView;
		private final RaceTreeViewModel availableModel;
		private final RaceTreeViewModel selectedModel;

		private TreeViewModelHandler(CharacterFacade character)
<span class="nc" id="L383">		{</span>
<span class="nc" id="L384">			availableView = new RaceDataView(character, true);</span>
<span class="nc" id="L385">			selectedView = new RaceDataView(character, false);</span>
<span class="nc" id="L386">			availableModel = new RaceTreeViewModel(character, true, availableView);</span>
<span class="nc" id="L387">			selectedModel = new RaceTreeViewModel(character, false, selectedView);</span>
<span class="nc" id="L388">		}</span>

		public void install()
		{
<span class="nc" id="L392">			raceTable.setTreeViewModel(availableModel);</span>
<span class="nc" id="L393">			selectedTable.setTreeViewModel(selectedModel);</span>
<span class="nc" id="L394">		}</span>
	}

	private static final class RaceDataView extends CachedDataView&lt;Race&gt;
	{

		private final List&lt;DefaultDataViewColumn&gt; columns;
		private final InfoFactory infoFactory;
		private final boolean isAvailModel;

		private RaceDataView(CharacterFacade character, boolean isAvailModel)
<span class="nc" id="L405">		{</span>
<span class="nc" id="L406">			this.infoFactory = character.getInfoFactory();</span>
<span class="nc" id="L407">			this.isAvailModel = isAvailModel;</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">			if (isAvailModel)</span>
			{
<span class="nc" id="L410">				columns = Arrays.asList(new DefaultDataViewColumn(&quot;in_irTableStat&quot;, String.class, true), //$NON-NLS-1$</span>
					new DefaultDataViewColumn(&quot;in_preReqs&quot;, String.class), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_size&quot;, String.class, true), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_movement&quot;, String.class, true), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_vision&quot;, String.class), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_favoredClass&quot;, String.class, true), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_lvlAdj&quot;, String.class, true), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_descrip&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_source&quot;, String.class, false)); //$NON-NLS-1$
			}
			else
			{
<span class="nc" id="L422">				columns = Arrays.asList(new DefaultDataViewColumn(&quot;in_irTableStat&quot;, String.class, false), //$NON-NLS-1$</span>
					new DefaultDataViewColumn(&quot;in_preReqs&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_size&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_movement&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_vision&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_favoredClass&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_lvlAdj&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_descrip&quot;, String.class, false), //$NON-NLS-1$
					new DefaultDataViewColumn(&quot;in_source&quot;, String.class, false)); //$NON-NLS-1$
			}
<span class="nc" id="L432">		}</span>

		@Override
		public List&lt;? extends DataViewColumn&gt; getDataColumns()
		{
<span class="nc" id="L437">			return columns;</span>
		}

		@Override
		public String getPrefsKey()
		{
<span class="nc bnc" id="L443" title="All 2 branches missed.">			return isAvailModel ? &quot;RaceTreeAvail&quot; : &quot;RaceTreeSelected&quot;; //$NON-NLS-1$//$NON-NLS-2$</span>
		}

		@Override
		public Object getDataInternal(Race obj, int column)
		{
<span class="nc bnc" id="L449" title="All 10 branches missed.">			return switch (column)</span>
					{
<span class="nc" id="L451">						case 0 -&gt; infoFactory.getStatAdjustments(obj);</span>
<span class="nc" id="L452">						case 1 -&gt; infoFactory.getPreReqHTML(obj);</span>
<span class="nc" id="L453">						case 2 -&gt; infoFactory.getSize(obj);</span>
<span class="nc" id="L454">						case 3 -&gt; infoFactory.getMovement(obj);</span>
<span class="nc" id="L455">						case 4 -&gt; infoFactory.getVision(obj);</span>
<span class="nc" id="L456">						case 5 -&gt; infoFactory.getFavoredClass(obj);</span>
<span class="nc" id="L457">						case 6 -&gt; infoFactory.getLevelAdjustment(obj);</span>
<span class="nc" id="L458">						case 7 -&gt; infoFactory.getDescription(obj);</span>
<span class="nc" id="L459">						case 8 -&gt; obj.getSource();</span>
<span class="nc" id="L460">						default -&gt; null;</span>
					};
		}

		@Override
		public void setData(Object value, Race element, int column)
		{
<span class="nc" id="L467">		}</span>

	}

	private static class RaceTreeViewModel implements TreeViewModel&lt;Race&gt;
	{

<span class="nc" id="L474">		private static final ListFacade&lt;? extends TreeView&lt;Race&gt;&gt; TREE_VIEWS =</span>
<span class="nc" id="L475">				new DefaultListFacade&lt;&gt;(Arrays.asList(RaceTreeView.values()));</span>
		private final CharacterFacade character;
		private final boolean isAvailModel;
		private final DataView&lt;Race&gt; dataView;

		RaceTreeViewModel(CharacterFacade character, boolean isAvailModel, DataView&lt;Race&gt; dataView)
<span class="nc" id="L481">		{</span>
<span class="nc" id="L482">			this.character = character;</span>
<span class="nc" id="L483">			this.isAvailModel = isAvailModel;</span>
<span class="nc" id="L484">			this.dataView = dataView;</span>
<span class="nc" id="L485">		}</span>

		@Override
		public ListFacade&lt;? extends TreeView&lt;Race&gt;&gt; getTreeViews()
		{
<span class="nc" id="L490">			return TREE_VIEWS;</span>
		}

		@Override
		public int getDefaultTreeViewIndex()
		{
<span class="nc" id="L496">			return 0;</span>
		}

		@Override
		public DataView&lt;Race&gt; getDataView()
		{
<span class="nc" id="L502">			return dataView;</span>
		}

		@Override
		public ListFacade&lt;Race&gt; getDataModel()
		{
<span class="nc bnc" id="L508" title="All 2 branches missed.">			if (isAvailModel)</span>
			{
<span class="nc" id="L510">				return character.getDataSet().getRaces();</span>
			}
			else
			{
<span class="nc" id="L514">				return new DelegatingSingleton&lt;&gt;(character.getRaceRef());</span>
			}
		}

	}

<span class="nc" id="L520">	private enum RaceTreeView implements TreeView&lt;Race&gt;</span>
	{

<span class="nc" id="L523">		NAME(LanguageBundle.getString(&quot;in_nameLabel&quot;)), //$NON-NLS-1$</span>
<span class="nc" id="L524">		TYPE_NAME(LanguageBundle.getString(&quot;in_typeName&quot;)), //$NON-NLS-1$</span>
<span class="nc" id="L525">		RACETYPE_NAME(LanguageBundle.getString(&quot;in_racetypeName&quot;)), //$NON-NLS-1$</span>
<span class="nc" id="L526">		RACETYPE_RACE_SUBTYPE_NAME(LanguageBundle.getString(&quot;in_racetypeSubtypeName&quot;)), //$NON-NLS-1$</span>
<span class="nc" id="L527">		SOURCE_NAME(LanguageBundle.getString(&quot;in_sourceName&quot;)); //$NON-NLS-1$</span>
		private final String name;

		private RaceTreeView(String name)
<span class="nc" id="L531">		{</span>
<span class="nc" id="L532">			this.name = name;</span>
<span class="nc" id="L533">		}</span>

		@Override
		public String getViewName()
		{
<span class="nc" id="L538">			return name;</span>
		}

		@Override
		public List&lt;TreeViewPath&lt;Race&gt;&gt; getPaths(Race pobj)
		{
<span class="nc bnc" id="L544" title="All 6 branches missed.">			switch (this)</span>
			{
				case NAME:
<span class="nc" id="L547">					return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj));</span>
				case TYPE_NAME:
<span class="nc" id="L549">					return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj, pobj.getType()));</span>
				case RACETYPE_RACE_SUBTYPE_NAME:
<span class="nc" id="L551">					List&lt;String&gt; subtypes = getRaceSubTypes(pobj);</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">					if (!subtypes.isEmpty())</span>
					{
<span class="nc" id="L554">						List&lt;TreeViewPath&lt;Race&gt;&gt; paths = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L555">						String raceType = getRaceType(pobj);</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">						for (String subtype : subtypes)</span>
						{
<span class="nc" id="L558">							paths.add(new TreeViewPath&lt;&gt;(pobj, raceType, subtype));</span>
<span class="nc" id="L559">						}</span>
<span class="nc" id="L560">						return paths;</span>
					}
					// No subtypes, fall through to treat it as a type tree.
<span class="nc" id="L563">					return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj, getRaceType(pobj)));</span>
				case RACETYPE_NAME:
<span class="nc" id="L565">					return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj, getRaceType(pobj)));</span>
				case SOURCE_NAME:
<span class="nc" id="L567">					return Collections.singletonList(new TreeViewPath&lt;&gt;(pobj, pobj.getSourceForNodeDisplay()));</span>
				default:
<span class="nc" id="L569">					throw new InternalError();</span>
			}
		}

		private static List&lt;String&gt; getRaceSubTypes(Race pobj)
		{
<span class="nc" id="L575">			List&lt;String&gt; subTypeNames = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L576">			List&lt;RaceSubType&gt; rst = pobj.getListFor(ListKey.RACESUBTYPE);</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">			if (rst != null)</span>
			{
<span class="nc bnc" id="L579" title="All 2 branches missed.">				for (RaceSubType subtype : rst)</span>
				{
<span class="nc" id="L581">					subTypeNames.add(subtype.toString());</span>
<span class="nc" id="L582">				}</span>
			}
<span class="nc" id="L584">			return subTypeNames;</span>
		}

		private static String getRaceType(Race race)
		{
<span class="nc" id="L589">			RaceType rt = race.getSafe(ObjectKey.RACETYPE);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">			return rt == null ? &quot;&quot; : rt.toString();</span>
		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>