<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractSubAssociationFacet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.cdom.facet.base</a> &gt; <span class="el_source">AbstractSubAssociationFacet.java</span></div><h1>AbstractSubAssociationFacet.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) Thomas Parker, 2012.
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this library; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA
 */
package pcgen.cdom.facet.base;

import java.util.Collection;
import java.util.Collections;
import java.util.IdentityHashMap;
import java.util.Map;
import java.util.Objects;
import java.util.Set;

import pcgen.cdom.base.PCGenIdentifier;

<span class="fc" id="L29">public abstract class AbstractSubAssociationFacet&lt;IDT extends PCGenIdentifier, S1, S2, A&gt;</span>
		extends AbstractStorageFacet&lt;IDT&gt;
{

	public A get(IDT id, S1 obj1, S2 obj2)
	{
<span class="nc" id="L35">		Objects.requireNonNull(obj1, &quot;Object for getting association may not be null&quot;);</span>
<span class="nc" id="L36">		Objects.requireNonNull(obj2, &quot;Object for getting association may not be null&quot;);</span>
<span class="nc" id="L37">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">		if (map == null)</span>
		{
<span class="nc" id="L40">			return null;</span>
		}
<span class="nc" id="L42">		Map&lt;S2, A&gt; subMap = map.get(obj1);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">		if (subMap == null)</span>
		{
<span class="nc" id="L45">			return null;</span>
		}
<span class="nc" id="L47">		return subMap.get(obj2);</span>
	}

	public boolean set(IDT id, S1 obj1, S2 obj2, A association)
	{
<span class="fc" id="L52">		Objects.requireNonNull(obj1, &quot;Object to add may not be null&quot;);</span>
<span class="fc" id="L53">		Objects.requireNonNull(obj2, &quot;Object to add may not be null&quot;);</span>
<span class="fc" id="L54">		Objects.requireNonNull(association, &quot;Association may not be null&quot;);</span>
<span class="fc" id="L55">		Map&lt;S2, A&gt; map = getConstructingCachedMap(id, obj1);</span>
<span class="fc" id="L56">		A old = map.put(obj2, association);</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">		return old == null;</span>
	}

	public void remove(IDT id, S1 obj1, S2 obj2)
	{
<span class="nc" id="L62">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (map != null)</span>
		{
<span class="nc" id="L65">			Map&lt;S2, A&gt; subMap = map.get(obj1);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">			if (subMap != null)</span>
			{
<span class="nc" id="L68">				subMap.remove(obj2);</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">				if (subMap.isEmpty())</span>
				{
<span class="nc" id="L71">					map.remove(obj1);</span>
				}
			}
		}
<span class="nc" id="L75">	}</span>

	public Map&lt;S1, Map&lt;S2, A&gt;&gt; removeAll(IDT id)
	{
		@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L80">		Map&lt;S1, Map&lt;S2, A&gt;&gt; componentMap = (Map&lt;S1, Map&lt;S2, A&gt;&gt;) removeCache(id);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">		if (componentMap == null)</span>
		{
<span class="nc" id="L83">			return Collections.emptyMap();</span>
		}
<span class="nc" id="L85">		return componentMap;</span>
	}

	public boolean isEmpty(IDT id)
	{
<span class="nc" id="L90">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">		return map == null || map.isEmpty();</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	protected Map&lt;S1, Map&lt;S2, A&gt;&gt; getCachedMap(IDT id)
	{
<span class="fc" id="L97">		return (Map&lt;S1, Map&lt;S2, A&gt;&gt;) getCache(id);</span>
	}

	private Map&lt;S2, A&gt; getConstructingCachedMap(IDT id, S1 obj1)
	{
<span class="fc" id="L102">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">		if (map == null)</span>
		{
<span class="fc" id="L105">			map = getComponentMap();</span>
<span class="fc" id="L106">			setCache(id, map);</span>
		}
<span class="fc" id="L108">        return map.computeIfAbsent(obj1, k -&gt; getSubComponentMap());</span>
	}

	protected &lt;MV&gt; Map&lt;S1, MV&gt; getComponentMap()
	{
<span class="fc" id="L113">		return new IdentityHashMap&lt;&gt;();</span>
	}

	protected &lt;MV&gt; Map&lt;S2, MV&gt; getSubComponentMap()
	{
<span class="nc" id="L118">		return new IdentityHashMap&lt;&gt;();</span>
	}

	@Override
	public void copyContents(IDT source, IDT destination)
	{
<span class="nc" id="L124">		Map&lt;S1, Map&lt;S2, A&gt;&gt; sourceMap = getCachedMap(source);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">		if (sourceMap != null)</span>
		{
<span class="nc bnc" id="L127" title="All 2 branches missed.">			for (Map.Entry&lt;S1, Map&lt;S2, A&gt;&gt; me : sourceMap.entrySet())</span>
			{
<span class="nc" id="L129">				getConstructingCachedMap(destination, me.getKey()).putAll(me.getValue());</span>
<span class="nc" id="L130">			}</span>
		}
<span class="nc" id="L132">	}</span>

	public Collection&lt;S1&gt; getObjects(IDT id)
	{
<span class="nc" id="L136">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">		if (map == null)</span>
		{
<span class="nc" id="L139">			return Collections.emptyList();</span>
		}
<span class="nc" id="L141">		Set&lt;S1&gt; set = Collections.newSetFromMap(getComponentMap());</span>
<span class="nc" id="L142">		set.addAll(map.keySet());</span>
<span class="nc" id="L143">		return set;</span>
	}

	public Collection&lt;S2&gt; getSubObjects(IDT id, S1 obj1)
	{
<span class="nc" id="L148">		Map&lt;S1, Map&lt;S2, A&gt;&gt; map = getCachedMap(id);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (map == null)</span>
		{
<span class="nc" id="L151">			return Collections.emptyList();</span>
		}
<span class="nc" id="L153">		Map&lt;S2, A&gt; subMap = map.get(obj1);</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (subMap == null)</span>
		{
<span class="nc" id="L156">			return Collections.emptyList();</span>
		}
<span class="nc" id="L158">		Set&lt;S2&gt; set = Collections.newSetFromMap(getSubComponentMap());</span>
<span class="nc" id="L159">		set.addAll(subMap.keySet());</span>
<span class="nc" id="L160">		return set;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>