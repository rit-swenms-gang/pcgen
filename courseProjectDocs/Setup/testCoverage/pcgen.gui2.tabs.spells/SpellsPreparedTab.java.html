<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SpellsPreparedTab.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.tabs.spells</a> &gt; <span class="el_source">SpellsPreparedTab.java</span></div><h1>SpellsPreparedTab.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2011 Connor Petty &lt;cpmeister@users.sourceforge.net&gt;
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 * 
 */
package pcgen.gui2.tabs.spells;

import java.awt.BorderLayout;
import java.awt.event.ActionEvent;
import java.util.List;

import javax.swing.AbstractAction;
import javax.swing.Box;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextField;
import javax.swing.JTree;
import javax.swing.SwingConstants;
import javax.swing.tree.TreePath;

import pcgen.core.PCClass;
import pcgen.facade.core.CharacterFacade;
import pcgen.facade.core.SpellFacade;
import pcgen.facade.core.SpellSupportFacade.SpellNode;
import pcgen.facade.core.SpellSupportFacade.SuperNode;
import pcgen.facade.util.ListFacade;
import pcgen.gui2.filter.Filter;
import pcgen.gui2.filter.FilterBar;
import pcgen.gui2.filter.FilterButton;
import pcgen.gui2.filter.FilterUtilities;
import pcgen.gui2.filter.FilteredTreeViewTable;
import pcgen.gui2.filter.SearchFilterPanel;
import pcgen.gui2.tabs.CharacterInfoTab;
import pcgen.gui2.tabs.TabTitle;
import pcgen.gui2.tools.FlippingSplitPane;
import pcgen.gui2.tools.Icons;
import pcgen.gui2.tools.InfoPane;
import pcgen.gui2.util.JTreeViewTable;
import pcgen.gui2.util.table.SortableTableModel;
import pcgen.gui2.util.table.SortableTableRowSorter;
import pcgen.gui2.util.treeview.TreeViewModel;
import pcgen.system.LanguageBundle;
import pcgen.util.enumeration.Tab;

import org.apache.commons.lang3.StringUtils;

@SuppressWarnings(&quot;serial&quot;)
public class SpellsPreparedTab extends FlippingSplitPane implements CharacterInfoTab
{

<span class="nc" id="L67">	private final TabTitle tabTitle = new TabTitle(Tab.PREPARED_SPELLS);</span>
	private final FilteredTreeViewTable&lt;CharacterFacade, SuperNode&gt; availableTable;
	private final JTreeViewTable&lt;SuperNode&gt; selectedTable;
	private final QualifiedSpellTreeCellRenderer spellRenderer;
	private final JButton addMMSpellButton;
	private final JButton addSpellButton;
	private final JButton removeSpellButton;
	private final FilterButton&lt;CharacterFacade, SuperNode&gt; qFilterButton;
	private final JButton addSpellListButton;
	private final JButton removeSpellListButton;
	private final JCheckBox slotsBox;
	private final JTextField spellListField;
	private final InfoPane spellsPane;
	private final InfoPane classPane;

	public SpellsPreparedTab()
<span class="nc" id="L83">	{</span>
<span class="nc" id="L84">		this.availableTable = new FilteredTreeViewTable&lt;&gt;();</span>
<span class="nc" id="L85">		this.selectedTable = new JTreeViewTable&lt;&gt;()</span>
<span class="nc" id="L86">		{</span>

			@Override
			public void setTreeViewModel(TreeViewModel&lt;SuperNode&gt; viewModel)
			{
<span class="nc" id="L91">				super.setTreeViewModel(viewModel);</span>
<span class="nc" id="L92">				sortModel();</span>
<span class="nc" id="L93">			}</span>

		};
<span class="nc" id="L96">		this.spellRenderer = new QualifiedSpellTreeCellRenderer();</span>
<span class="nc" id="L97">		this.addMMSpellButton = new JButton();</span>
<span class="nc" id="L98">		this.addSpellButton = new JButton();</span>
<span class="nc" id="L99">		this.removeSpellButton = new JButton();</span>
<span class="nc" id="L100">		this.qFilterButton = new FilterButton&lt;&gt;(&quot;SpellPreparedQualified&quot;);</span>
<span class="nc" id="L101">		this.addSpellListButton = new JButton();</span>
<span class="nc" id="L102">		this.removeSpellListButton = new JButton();</span>
<span class="nc" id="L103">		this.slotsBox = new JCheckBox();</span>
<span class="nc" id="L104">		this.spellListField = new JTextField();</span>
<span class="nc" id="L105">		this.spellsPane = new InfoPane(LanguageBundle.getString(&quot;InfoSpells.spell.info&quot;));</span>
<span class="nc" id="L106">		this.classPane = new InfoPane(LanguageBundle.getString(&quot;InfoSpells.class.info&quot;));</span>
<span class="nc" id="L107">		initComponents();</span>
<span class="nc" id="L108">	}</span>

	private void initComponents()
	{
<span class="nc" id="L112">		availableTable.setTreeCellRenderer(spellRenderer);</span>
<span class="nc" id="L113">		selectedTable.setTreeCellRenderer(spellRenderer);</span>
<span class="nc" id="L114">		selectedTable.setRowSorter(new SortableTableRowSorter()</span>
<span class="nc" id="L115">		{</span>

			@Override
			public SortableTableModel getModel()
			{
<span class="nc" id="L120">				return (SortableTableModel) selectedTable.getModel();</span>
			}

		});
<span class="nc" id="L124">		selectedTable.getRowSorter().toggleSortOrder(0);</span>
<span class="nc" id="L125">		FilterBar&lt;CharacterFacade, SuperNode&gt; filterBar = new FilterBar&lt;&gt;();</span>
<span class="nc" id="L126">		filterBar.addDisplayableFilter(new SearchFilterPanel());</span>
<span class="nc" id="L127">		qFilterButton.setText(LanguageBundle.getString(&quot;in_igQualFilter&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L128">		filterBar.addDisplayableFilter(qFilterButton);</span>

<span class="nc" id="L130">		FlippingSplitPane upperPane = new FlippingSplitPane();</span>
<span class="nc" id="L131">		JPanel availPanel = FilterUtilities.configureFilteredTreeViewPane(availableTable, filterBar);</span>
<span class="nc" id="L132">		Box box = Box.createVerticalBox();</span>
<span class="nc" id="L133">		box.add(Box.createVerticalStrut(5));</span>
		{
<span class="nc" id="L135">			Box hbox = Box.createHorizontalBox();</span>
<span class="nc" id="L136">			addMMSpellButton.setHorizontalTextPosition(SwingConstants.LEADING);</span>
<span class="nc" id="L137">			hbox.add(addMMSpellButton);</span>
<span class="nc" id="L138">			box.add(hbox);</span>
		}
<span class="nc" id="L140">		box.add(Box.createVerticalStrut(2));</span>
		{
<span class="nc" id="L142">			Box hbox = Box.createHorizontalBox();</span>
<span class="nc" id="L143">			hbox.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L144">			hbox.add(slotsBox);</span>
<span class="nc" id="L145">			hbox.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L146">			hbox.add(Box.createHorizontalStrut(10));</span>
<span class="nc" id="L147">			hbox.add(addSpellButton);</span>
<span class="nc" id="L148">			box.add(hbox);</span>
		}
<span class="nc" id="L150">		availPanel.add(box, BorderLayout.SOUTH);</span>
<span class="nc" id="L151">		upperPane.setLeftComponent(availPanel);</span>

<span class="nc" id="L153">		JPanel rightPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L154">		rightPanel.add(new JScrollPane(selectedTable), BorderLayout.CENTER);</span>
		{
<span class="nc" id="L156">			Box hbox = Box.createHorizontalBox();</span>
<span class="nc" id="L157">			hbox.add(removeSpellButton);</span>
<span class="nc" id="L158">			hbox.add(Box.createHorizontalStrut(10));</span>
<span class="nc" id="L159">			hbox.add(new JLabel(LanguageBundle.getString(&quot;InfoPreparedSpells.preparedList&quot;)));</span>
<span class="nc" id="L160">			hbox.add(Box.createHorizontalStrut(3));</span>
<span class="nc" id="L161">			hbox.add(spellListField);</span>
<span class="nc" id="L162">			hbox.add(Box.createHorizontalStrut(3));</span>
<span class="nc" id="L163">			hbox.add(addSpellListButton);</span>
<span class="nc" id="L164">			hbox.add(Box.createHorizontalStrut(3));</span>
<span class="nc" id="L165">			hbox.add(removeSpellListButton);</span>
<span class="nc" id="L166">			rightPanel.add(hbox, BorderLayout.SOUTH);</span>
		}
<span class="nc" id="L168">		upperPane.setRightComponent(rightPanel);</span>
<span class="nc" id="L169">		upperPane.setResizeWeight(0);</span>
<span class="nc" id="L170">		setTopComponent(upperPane);</span>

<span class="nc" id="L172">		FlippingSplitPane bottomPane = new FlippingSplitPane();</span>
<span class="nc" id="L173">		bottomPane.setLeftComponent(spellsPane);</span>
<span class="nc" id="L174">		bottomPane.setRightComponent(classPane);</span>
<span class="nc" id="L175">		setBottomComponent(bottomPane);</span>
<span class="nc" id="L176">		setOrientation(VERTICAL_SPLIT);</span>
<span class="nc" id="L177">	}</span>

	@Override
	public ModelMap createModels(CharacterFacade character)
	{
<span class="nc" id="L182">		ModelMap models = new ModelMap();</span>
<span class="nc" id="L183">		models.put(TreeViewModelHandler.class, new TreeViewModelHandler(character));</span>
<span class="nc" id="L184">		models.put(AddMMSpellAction.class, new AddMMSpellAction(character));</span>
<span class="nc" id="L185">		models.put(AddSpellAction.class, new AddSpellAction(character));</span>
<span class="nc" id="L186">		models.put(RemoveSpellAction.class, new RemoveSpellAction(character));</span>
<span class="nc" id="L187">		models.put(AddSpellListAction.class, new AddSpellListAction(character));</span>
<span class="nc" id="L188">		models.put(RemoveSpellListAction.class, new RemoveSpellListAction(character));</span>
<span class="nc" id="L189">		models.put(UseHigherSlotsAction.class, new UseHigherSlotsAction(character));</span>
<span class="nc" id="L190">		models.put(SpellInfoHandler.class, new SpellInfoHandler(character, availableTable, selectedTable, spellsPane));</span>
<span class="nc" id="L191">		models.put(ClassInfoHandler.class, new ClassInfoHandler(character, availableTable, selectedTable, classPane));</span>
<span class="nc" id="L192">		models.put(SpellFilterHandler.class, new SpellFilterHandler(character));</span>
<span class="nc" id="L193">		return models;</span>
	}

	@Override
	public void restoreModels(ModelMap models)
	{
<span class="nc" id="L199">		models.get(SpellFilterHandler.class).install();</span>
<span class="nc" id="L200">		models.get(TreeViewModelHandler.class).install();</span>
<span class="nc" id="L201">		models.get(SpellInfoHandler.class).install();</span>
<span class="nc" id="L202">		models.get(ClassInfoHandler.class).install();</span>
<span class="nc" id="L203">		models.get(AddSpellAction.class).install();</span>
<span class="nc" id="L204">		models.get(RemoveSpellAction.class).install();</span>
<span class="nc" id="L205">		addMMSpellButton.setAction(models.get(AddMMSpellAction.class));</span>
<span class="nc" id="L206">		addSpellListButton.setAction(models.get(AddSpellListAction.class));</span>
<span class="nc" id="L207">		removeSpellListButton.setAction(models.get(RemoveSpellListAction.class));</span>
<span class="nc" id="L208">		models.get(UseHigherSlotsAction.class).install();</span>
<span class="nc" id="L209">	}</span>

	@Override
	public void storeModels(ModelMap models)
	{
<span class="nc" id="L214">		models.get(SpellInfoHandler.class).uninstall();</span>
<span class="nc" id="L215">		models.get(ClassInfoHandler.class).uninstall();</span>
<span class="nc" id="L216">		models.get(AddSpellAction.class).uninstall();</span>
<span class="nc" id="L217">		models.get(RemoveSpellAction.class).uninstall();</span>
<span class="nc" id="L218">		models.get(TreeViewModelHandler.class).uninstall();</span>
<span class="nc" id="L219">	}</span>

	@Override
	public TabTitle getTabTitle()
	{
<span class="nc" id="L224">		return tabTitle;</span>
	}

	/**
	 * Identify the current spell list, being the spell list that spell should
	 * be added to. If no lists exist then a default one will be created.
	 *
	 * @param character The character qwe are checking for.
	 * @return The name of the 'current' spell list.
	 */
	String getCurrentSpellListName(CharacterFacade character)
	{
<span class="nc" id="L236">		String spellList = &quot;&quot;;</span>
<span class="nc" id="L237">		Object selectedObject = selectedTable.getSelectedObject();</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		if (selectedObject != null)</span>
		{
<span class="nc bnc" id="L240" title="All 2 branches missed.">			if (selectedObject instanceof SpellNode)</span>
			{
<span class="nc" id="L242">				spellList = ((SpellNode) selectedObject).getRootNode().toString();</span>
			}
			else
			{
<span class="nc" id="L246">				JTree tree = selectedTable.getTree();</span>
<span class="nc" id="L247">				TreePath path = tree.getSelectionPath();</span>
<span class="nc bnc" id="L248" title="All 4 branches missed.">				while (path.getParentPath() != null &amp;&amp; (path.getParentPath().getParentPath() != null))</span>
				{
<span class="nc" id="L250">					path = path.getParentPath();</span>
				}
<span class="nc" id="L252">				spellList = path.getLastPathComponent().toString();</span>
			}
		}
<span class="nc bnc" id="L255" title="All 2 branches missed.">		if (StringUtils.isEmpty(spellList))</span>
		{
<span class="nc" id="L257">			spellList = spellListField.getText();</span>
		}
<span class="nc bnc" id="L259" title="All 2 branches missed.">		if (StringUtils.isEmpty(spellList))</span>
		{
<span class="nc" id="L261">			ListFacade&lt;?&gt; data = selectedTable.getTreeViewModel().getDataModel();</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">			if (!data.isEmpty())</span>
			{
<span class="nc" id="L264">				Object firstElem = data.getElementAt(0);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">				if (firstElem instanceof SpellNode)</span>
				{
<span class="nc" id="L267">					spellList = ((SpellNode) firstElem).getRootNode().toString();</span>
				}
			}
		}
<span class="nc bnc" id="L271" title="All 2 branches missed.">		if (StringUtils.isEmpty(spellList))</span>
		{
			// No lists exist, so create a default one!
<span class="nc" id="L274">			spellList = &quot;Prepared Spells&quot;;</span>
<span class="nc" id="L275">			character.getSpellSupport().addSpellList(spellList);</span>
		}
<span class="nc" id="L277">		return spellList;</span>
	}

	private class AddMMSpellAction extends AbstractAction
	{

		private CharacterFacade character;

		public AddMMSpellAction(CharacterFacade character)
<span class="nc" id="L286">		{</span>
<span class="nc" id="L287">			this.character = character;</span>
<span class="nc" id="L288">			String label = character.getDataSet().getGameMode().getAddWithMetamagicMessage();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">			if (StringUtils.isEmpty(label))</span>
			{
<span class="nc" id="L291">				label = LanguageBundle.getString(&quot;InfoSpells.add.with.metamagic&quot;);</span>
			}
<span class="nc" id="L293">			putValue(NAME, label);</span>
<span class="nc" id="L294">			putValue(SMALL_ICON, Icons.Forward16.getImageIcon());</span>
<span class="nc" id="L295">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L300">			List&lt;?&gt; data = availableTable.getSelectedData();</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">			for (Object object : data)</span>
			{
<span class="nc bnc" id="L303" title="All 2 branches missed.">				if (object instanceof SpellNode)</span>
				{
<span class="nc" id="L305">					String spellList = getCurrentSpellListName(character);</span>
<span class="nc" id="L306">					character.getSpellSupport().addPreparedSpell((SpellNode) object, spellList, true);</span>
				}
<span class="nc" id="L308">			}</span>
<span class="nc" id="L309">		}</span>

	}

	private class AddSpellAction extends AbstractAction
	{

		private CharacterFacade character;

		public AddSpellAction(CharacterFacade character)
<span class="nc" id="L319">		{</span>
<span class="nc" id="L320">			this.character = character;</span>
<span class="nc" id="L321">			putValue(SMALL_ICON, Icons.Forward16.getImageIcon());</span>
<span class="nc" id="L322">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L327">			List&lt;?&gt; data = availableTable.getSelectedData();</span>
<span class="nc" id="L328">			String spellList = getCurrentSpellListName(character);</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">			for (Object object : data)</span>
			{
<span class="nc bnc" id="L331" title="All 2 branches missed.">				if (object instanceof SpellNode)</span>
				{
<span class="nc" id="L333">					character.getSpellSupport().addPreparedSpell((SpellNode) object, spellList, false);</span>
				}
<span class="nc" id="L335">			}</span>
<span class="nc" id="L336">		}</span>

		public void install()
		{
<span class="nc" id="L340">			availableTable.addActionListener(this);</span>
<span class="nc" id="L341">			addSpellButton.setAction(this);</span>
<span class="nc" id="L342">		}</span>

		public void uninstall()
		{
<span class="nc" id="L346">			availableTable.removeActionListener(this);</span>
<span class="nc" id="L347">		}</span>

	}

	private class RemoveSpellAction extends AbstractAction
	{

		private CharacterFacade character;

		public RemoveSpellAction(CharacterFacade character)
<span class="nc" id="L357">		{</span>
<span class="nc" id="L358">			this.character = character;</span>
<span class="nc" id="L359">			putValue(SMALL_ICON, Icons.Back16.getImageIcon());</span>
<span class="nc" id="L360">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L365">			List&lt;?&gt; data = selectedTable.getSelectedData();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">			for (Object object : data)</span>
			{
<span class="nc bnc" id="L368" title="All 2 branches missed.">				if (object instanceof SpellNode spellNode)</span>
				{
<span class="nc" id="L370">					character.getSpellSupport().removePreparedSpell(spellNode, spellNode.getRootNode().toString());</span>
				}
<span class="nc" id="L372">			}</span>
<span class="nc" id="L373">		}</span>

		public void install()
		{
<span class="nc" id="L377">			selectedTable.addActionListener(this);</span>
<span class="nc" id="L378">			removeSpellButton.setAction(this);</span>
<span class="nc" id="L379">		}</span>

		public void uninstall()
		{
<span class="nc" id="L383">			selectedTable.removeActionListener(this);</span>
<span class="nc" id="L384">		}</span>

	}

	private class UseHigherSlotsAction extends AbstractAction
	{

		private CharacterFacade character;

		public UseHigherSlotsAction(CharacterFacade character)
<span class="nc" id="L394">		{</span>
<span class="nc" id="L395">			super(LanguageBundle.getString(&quot;InfoPreparedSpells.canUseHigherSlots&quot;));</span>
<span class="nc" id="L396">			this.character = character;</span>
<span class="nc" id="L397">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L402">			character.getSpellSupport().setUseHigherPreppedSlots(slotsBox.isSelected());</span>
<span class="nc" id="L403">		}</span>

		public void install()
		{
<span class="nc" id="L407">			slotsBox.setAction(this);</span>
<span class="nc" id="L408">			slotsBox.setSelected(character.getSpellSupport().isUseHigherPreppedSlots());</span>
<span class="nc" id="L409">		}</span>

	}

	private class AddSpellListAction extends AbstractAction
	{

		private CharacterFacade character;

		public AddSpellListAction(CharacterFacade character)
<span class="nc" id="L419">		{</span>
<span class="nc" id="L420">			super(LanguageBundle.getString(&quot;InfoSpells.add&quot;));</span>
<span class="nc" id="L421">			this.character = character;</span>
<span class="nc" id="L422">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L427">			character.getSpellSupport().addSpellList(spellListField.getText());</span>
<span class="nc" id="L428">		}</span>

	}

	private class RemoveSpellListAction extends AbstractAction
	{

		private CharacterFacade character;

		public RemoveSpellListAction(CharacterFacade character)
<span class="nc" id="L438">		{</span>
<span class="nc" id="L439">			super(LanguageBundle.getString(&quot;InfoSpells.delete&quot;));</span>
<span class="nc" id="L440">			this.character = character;</span>
<span class="nc" id="L441">		}</span>

		@Override
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L446">			character.getSpellSupport().removeSpellList(spellListField.getText());</span>
<span class="nc" id="L447">		}</span>

	}

	private class TreeViewModelHandler
	{

		private SpellTreeViewModel availableModel;
		private SpellTreeViewModel selectedModel;
		private CharacterFacade character;

		public TreeViewModelHandler(CharacterFacade character)
<span class="nc" id="L459">		{</span>
<span class="nc" id="L460">			this.character = character;</span>
<span class="nc" id="L461">			availableModel = new SpellTreeViewModel(character.getSpellSupport().getKnownSpellNodes(), false,</span>
<span class="nc" id="L462">				&quot;SpellsPrepAva&quot;, character.getInfoFactory());</span>
<span class="nc" id="L463">			selectedModel = new SpellTreeViewModel(character.getSpellSupport().getPreparedSpellNodes(), true,</span>
<span class="nc" id="L464">				&quot;SpellsPrepSel&quot;, character.getInfoFactory());</span>
<span class="nc" id="L465">		}</span>

		public void install()
		{
<span class="nc" id="L469">			spellRenderer.setCharacter(character);</span>
<span class="nc" id="L470">			availableTable.setTreeViewModel(availableModel);</span>
<span class="nc" id="L471">			selectedTable.setTreeViewModel(selectedModel);</span>
<span class="nc" id="L472">		}</span>

		public void uninstall()
		{
<span class="nc" id="L476">			spellRenderer.setCharacter(null);</span>
<span class="nc" id="L477">		}</span>

	}

	private class SpellFilterHandler implements Filter&lt;CharacterFacade, SuperNode&gt;
	{

		private final CharacterFacade character;

		public SpellFilterHandler(CharacterFacade character)
<span class="nc" id="L487">		{</span>
<span class="nc" id="L488">			this.character = character;</span>
<span class="nc" id="L489">		}</span>

		public void install()
		{
<span class="nc" id="L493">			qFilterButton.setFilter(this);</span>
<span class="nc" id="L494">		}</span>

		@Override
		public boolean accept(CharacterFacade context, SuperNode element)
		{
<span class="nc bnc" id="L499" title="All 2 branches missed.">			if (element instanceof SpellNode spellNode)</span>
			{
<span class="nc" id="L501">				SpellFacade spell = spellNode.getSpell();</span>
<span class="nc" id="L502">				PCClass pcClass = spellNode.getSpellcastingClass();</span>
<span class="nc" id="L503">				return character.isQualifiedFor(spell, pcClass);</span>
			}
<span class="nc" id="L505">			return true;</span>
		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>