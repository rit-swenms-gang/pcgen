<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CNAbility.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.cdom.content</a> &gt; <span class="el_source">CNAbility.java</span></div><h1>CNAbility.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2008-14 Tom Parker &lt;thpr@users.sourceforge.net&gt;
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation; either version 2.1 of the License, or (at your option)
 * any later version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this library; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA
 */
package pcgen.cdom.content;

import java.util.List;
import java.util.Objects;

import pcgen.base.formula.Formula;
import pcgen.cdom.base.CDOMObject;
import pcgen.cdom.base.Category;
import pcgen.cdom.base.ChooseDriver;
import pcgen.cdom.base.ChooseInformation;
import pcgen.cdom.base.ChooseSelectionActor;
import pcgen.cdom.base.ConcretePrereqObject;
import pcgen.cdom.base.QualifyingObject;
import pcgen.cdom.base.Reducible;
import pcgen.cdom.enumeration.FormulaKey;
import pcgen.cdom.enumeration.ListKey;
import pcgen.cdom.enumeration.Nature;
import pcgen.cdom.enumeration.ObjectKey;
import pcgen.core.Ability;

/**
 * An CNAbility represents an &quot;unresolved&quot; (categorized) Ability &amp;amp; Nature.
 */
public class CNAbility extends ConcretePrereqObject
		implements QualifyingObject, Comparable&lt;CNAbility&gt;, ChooseDriver, Reducible
{

	private final Category&lt;Ability&gt; category;

	/**
	 * The Ability that this CNAbility represents
	 */
	private final Ability ability;

	/**
	 * The Nature of the Ability
	 */
	private final Nature nature;

	/**
	 * Creates a new CNAbility for the given Ability.
	 * 
	 * @param abil
	 *            The Ability which this CNAbility will contain
	 * @param nat
	 *            The Nature of the given Ability
	 */
	CNAbility(Category&lt;Ability&gt; cat, Ability abil, Nature nat)
<span class="fc" id="L66">	{</span>
<span class="fc" id="L67">		Objects.requireNonNull(cat, &quot;Cannot build CNAbility with null Category&quot;);</span>
<span class="fc" id="L68">		Objects.requireNonNull(abil, &quot;Cannot build CNAbility with null Ability&quot;);</span>
<span class="fc" id="L69">		Objects.requireNonNull(nat, &quot;Cannot build CNAbility with null Nature&quot;);</span>
<span class="pc bpc" id="L70" title="2 of 4 branches missed.">		if (abil.getKeyName() == null || abil.getKeyName().isEmpty())</span>
		{
<span class="nc" id="L72">			throw new IllegalArgumentException(&quot;Cannot build CNAbility when Ability has no key&quot;);</span>
		}
<span class="fc" id="L74">		Category&lt;Ability&gt; origCategory = abil.getCDOMCategory();</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">		if (origCategory == null)</span>
		{
<span class="nc" id="L77">			throw new IllegalArgumentException(</span>
				&quot;Cannot build CNAbility for &quot; + abil + &quot; when Ability has null original Category&quot;);
		}
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">		if (!cat.getParentCategory().equals(origCategory))</span>
		{
<span class="nc" id="L82">			throw new IllegalArgumentException(&quot;Cannot build CNAbility for &quot; + abil + &quot; with incompatible Category: &quot;</span>
				+ cat + &quot; is not compatible with Ability's Category: &quot; + origCategory);
		}
<span class="fc" id="L85">		category = cat;</span>
<span class="fc" id="L86">		ability = abil;</span>
<span class="fc" id="L87">		nature = nat;</span>
<span class="fc" id="L88">	}</span>

	/**
	 * Returns the key for the Ability in this CNAbility.
	 * 
	 * @return The key for the Ability in this CNAbility.
	 */
	public String getAbilityKey()
	{
<span class="fc" id="L97">		return ability.getKeyName();</span>
	}

	/**
	 * Returns the Category for the Ability in this CNAbility.
	 * 
	 * @return The Category for the Ability in this CNAbility.
	 */
	public Category&lt;Ability&gt; getAbilityCategory()
	{
<span class="fc" id="L107">		return category;</span>
	}

	/**
	 * Returns a String representation of this CNAbility. 
	 * 
	 * @return A String representation of this CNAbility.
	 */
	@Override
	public String toString()
	{
<span class="nc" id="L118">		return ability.getDisplayName();</span>
	}

	/**
	 * Returns the Nature of the Ability
	 * 
	 * @return The Nature of the Ability
	 */
	public Nature getNature()
	{
<span class="fc" id="L128">		return nature;</span>
	}

	/**
	 * Returns the Ability that this CNAbility represents
	 * 
	 * @return The Ability that this CNAbility represents
	 */
	public Ability getAbility()
	{
<span class="fc" id="L138">		return ability;</span>
	}

	@Override
	public int hashCode()
	{
<span class="fc" id="L144">		return ability.hashCode();</span>
	}

	@Override
	public boolean equals(Object o)
	{
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">		if (o instanceof CNAbility other)</span>
		{
<span class="fc bfc" id="L152" title="All 6 branches covered.">			return category.equals(other.category) &amp;&amp; ability.equals(other.ability) &amp;&amp; nature == other.nature;</span>
		}
<span class="nc" id="L154">		return false;</span>
	}

	@Override
	public int compareTo(CNAbility other)
	{
<span class="nc" id="L160">		final int equal = 0;</span>

<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (this == other)</span>
		{
<span class="nc" id="L164">			return equal;</span>
		}

		// ability details
<span class="nc" id="L168">		int compare = this.ability.compareTo(other.ability);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if (compare != equal)</span>
		{
<span class="nc" id="L171">			return compare;</span>
		}
<span class="nc" id="L173">		compare = this.category.toString().compareTo(other.category.toString());</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">		if (compare != equal)</span>
		{
<span class="nc" id="L176">			return compare;</span>
		}
<span class="nc" id="L178">		compare = this.nature.compareTo(other.nature);</span>
<span class="nc" id="L179">		return compare;</span>
	}

	@Override
	public ChooseInformation&lt;?&gt; getChooseInfo()
	{
<span class="fc" id="L185">		return ability.get(ObjectKey.CHOOSE_INFO);</span>
	}

	@Override
	public Formula getSelectFormula()
	{
<span class="nc" id="L191">		return ability.getSafe(FormulaKey.SELECT);</span>
	}

	@Override
	public List&lt;ChooseSelectionActor&lt;?&gt;&gt; getActors()
	{
<span class="fc" id="L197">		return ability.getListFor(ListKey.NEW_CHOOSE_ACTOR);</span>
	}

	@Override
	public String getFormulaSource()
	{
<span class="nc" id="L203">		return ability.getKeyName();</span>
	}

	@Override
	public Formula getNumChoices()
	{
<span class="nc" id="L209">		return ability.getSafe(FormulaKey.NUMCHOICES);</span>
	}

	@Override
	public String getDisplayName()
	{
<span class="nc" id="L215">		return ability.getDisplayName();</span>
	}

	@Override
	public CDOMObject getCDOMObject()
	{
<span class="nc" id="L221">		return ability;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>