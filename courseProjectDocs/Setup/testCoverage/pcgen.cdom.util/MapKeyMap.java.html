<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MapKeyMap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.cdom.util</a> &gt; <span class="el_source">MapKeyMap.java</span></div><h1>MapKeyMap.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2008 (C) James Dempsey
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
 *
 */
package pcgen.cdom.util;

import java.util.Map;
import java.util.Set;

import pcgen.base.util.DoubleKeyMap;
import pcgen.cdom.enumeration.MapKey;

/**
 * This encapsulates a DoubleKeyMap in a typesafe and value-semantic way.
 * 
 * Specifically, when Generics are properly used by a class using a MapKeyMap,
 * this class ensures that any MapKey will only return a Map of the same Generic
 * type as the MapKey. Note this relationship is only enforced with Generics,
 * and could be violated if Generics are not properly used.
 * 
 * This Class also is reference-semantic with respect to the Maps. In other
 * words, the modification of any Collection returned by a MapKeyMap will not
 * impact the internal contents of the MapKeyMap. Also, any Collection used as a
 * parameter to a method is not stored directly, the Collection can be modified
 * after the method has returned without impacting the internal contents of the
 * MapKeyMap.
 * 
 * **NOTE** This class is NOT thread safe.
 * 
 * 
 */
<span class="fc" id="L47">public class MapKeyMap</span>
{

	/*
	 * Much as for ListKeyMapToList.map this must remain generic. See Tom's
	 * comment in that class for the full explanation.
	 */
	/** The internal storage of this MapKeyMap. */
<span class="fc" id="L55">	@SuppressWarnings(&quot;rawtypes&quot;)</span>
	private final DoubleKeyMap map = new DoubleKeyMap();

	/**
	 * Copies the key/value combinations from the given MapKeyMap into this
	 * MapKeyMap. If this MapKeyMap already contained a mapping for the any of
	 * the key combinations in the given MapKeyMap, the previous value is
	 * overwritten.
	 * 
	 * @param mkm
	 *            The MapKeyMap for which the key/value combinations should be
	 *            placed into this MapKeyMap
	 * 
	 * @throws NullPointerException
	 *             if the given MapKeyMap is null
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public final void putAll(MapKeyMap mkm)
	{
<span class="fc" id="L74">		map.putAll(mkm.map);</span>
<span class="fc" id="L75">	}</span>

	/**
	 * Adds the given value to the List for the given ListKey. The null value
	 * cannot be used as a key in a MapKeyMap. This method will automatically
	 * initialize the map for the given primary key if there is not already a
	 * Map for that primary key.
	 * 
	 * This method is reference-semantic and this MapKeyMap will maintain a
	 * strong reference to both the key object and the value object given as
	 * arguments to this method.
	 * 
	 * @param key1
	 *            The MapKey indicating which Map the given object should be
	 *            added to.
	 * @param value
	 *            The value to be added to the List for the given key.
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; V addToMapFor(MapKey&lt;K, V&gt; key1, K key2, V value)
	{
<span class="fc" id="L96">		return (V) map.put(key1, key2, value);</span>
	}

	/**
	 * Returns true if this MapKeyMap contains a Map for the given MapKey. This
	 * method returns false if the given key is not in this MapKeyMap.
	 * 
	 * This method is value-semantic in that no changes are made to the object
	 * passed into the method.
	 * 
	 * @param key
	 *            The MapKey being tested.
	 * @return true if this MapKeyMap contains a Map for the given key; false
	 *         otherwise.
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public boolean containsMapFor(MapKey&lt;?, ?&gt; key)
	{
<span class="fc" id="L114">		return map.containsKey(key);</span>
	}

	/**
	 * Returns a copy of the List contained in this MapKeyMap for the given
	 * ListKey. This method returns null if the given key is not in this
	 * MapKeyMap.
	 * 
	 * This method is value-semantic in that no changes are made to the object
	 * passed into the method and ownership of the returned List is transferred
	 * to the class calling this method.
	 * 
	 * @param key1
	 *           The MapKeyMap to find
	 * @param key2
	 * 			 The ListKey for which a copy of the list should be returned.
	 * @return a copy of the List contained in this MapKeyMap for the given key;
	 *         null if the given key is not a key in this MapKeyMap.
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; V get(MapKey&lt;K, V&gt; key1, K key2)
	{
<span class="fc" id="L136">		return (V) map.get(key1, key2);</span>
	}

	/**
	 * Returns a copy of the List contained in this MapKeyMap for the given
	 * ListKey. This method returns null if the given key is not in this
	 * MapKeyMap.
	 * 
	 * This method is value-semantic in that no changes are made to the object
	 * passed into the method and ownership of the returned List is transferred
	 * to the class calling this method.
	 * 
	 * @param key
	 *            The ListKey for which a copy of the list should be returned.
	 * @return a copy of the List contained in this MapKeyMap for the given key;
	 *         null if the given key is not a key in this MapKeyMap.
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; Map&lt;K, V&gt; getMapFor(MapKey&lt;K, V&gt; key)
	{
<span class="fc" id="L156">		return map.getMapFor(key);</span>
	}

	/**
	 * Returns a Set of the secondary keys for the given primary key in this
	 * MapKeyMap. This method returns an empty set if the given key is not in
	 * this MapKeyMap.
	 * 
	 * Note: This Set is reference-semantic. The ownership of the Set is
	 * transferred to the calling Object; therefore, changes to the returned Set
	 * will NOT impact the MapKeyMap.
	 * 
	 * @param key
	 *            The MapKey for which a copy of the keys should be returned.
	 * @return A &lt;tt&gt;Set&lt;/tt&gt; of secondary key objects for the given primary
	 *         key.
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; Set&lt;K&gt; getKeysFor(MapKey&lt;K, V&gt; key)
	{
<span class="fc" id="L176">		return map.getSecondaryKeySet(key);</span>
	}

	/**
	 * Removes the given value from the map for the given MapKey. Returns true
	 * if the value was successfully removed from the map for the given MapKey.
	 * Returns false if there is not a map for the given MapKey or if the map
	 * for the given MapKey did not contain the given secondary key.
	 * 
	 * @param key1
	 *            The MapKey indicating which Map the given object should be
	 *            removed from
	 * @param key2
	 *            The key to be removed from the Map
	 * @return true if the key and its associated value were successfully
	 *         removed from the map; false otherwise
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; boolean removeFromMapFor(MapKey&lt;K, V&gt; key1, K key2)
	{
<span class="fc bfc" id="L196" title="All 2 branches covered.">		return map.remove(key1, key2) != null;</span>
	}

	/**
	 * Removes the List for the given ListKey. Note there is no requirement that
	 * the list for the given key be empty before this method is called.
	 * 
	 * Ownership of the returned Map is transferred to the object calling this
	 * method.
	 * 
	 * @return The Map which this MapKeyMap previous mapped the given key
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public &lt;K, V&gt; Map&lt;K, V&gt; removeMapFor(MapKey&lt;K, V&gt; key)
	{
<span class="fc" id="L211">		return map.removeAll(key);</span>
	}

	/**
	 * Returns a Set indicating the Keys of this MapKeyMap. Ownership of the Set
	 * is transferred to the calling Object, no association is kept between the
	 * Set and this MapKeyMap. (Thus, removal of a key from the returned Set
	 * will not remove that key from this MapKeyMap)
	 * 
	 * NOTE: This method returns all of the keys this MapKeyMap contains. It
	 * DOES NOT determine whether the Lists defined for the keys are empty.
	 * Therefore, it is possible that this MapKeyMap contains one or more keys,
	 * and all of the lists associated with those keys are empty, yet this
	 * method will return a non-zero length Set.
	 * 
	 * @return a Set containing the keys in this MapKeyMap
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public Set&lt;MapKey&lt;?, ?&gt;&gt; getKeySet()
	{
<span class="fc" id="L231">		return map.getKeySet();</span>
	}

	/**
	 * Returns true if this structure contains no Maps.
	 * 
	 * @return true if this structure contains no Maps; false otherwise
	 */
	public boolean isEmpty()
	{
<span class="nc" id="L241">		return map.isEmpty();</span>
	}

	@Override
	public int hashCode()
	{
<span class="nc" id="L247">		return map.hashCode();</span>
	}

	@Override
	public boolean equals(Object obj)
	{
<span class="pc bpc" id="L253" title="2 of 4 branches missed.">		return obj instanceof MapKeyMap &amp;&amp; map.equals(((MapKeyMap) obj).map);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>