<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TempBonusFacadeImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pcgen</a> &gt; <a href="index.source.html" class="el_package">pcgen.gui2.facade</a> &gt; <span class="el_source">TempBonusFacadeImpl.java</span></div><h1>TempBonusFacadeImpl.java</h1><pre class="source lang-java linenums">/*
 * Copyright James Dempsey, 2012
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 */
package pcgen.gui2.facade;

import java.text.Collator;
import java.util.List;

import pcgen.base.lang.StringUtil;
import pcgen.cdom.base.CDOMObject;
import pcgen.cdom.enumeration.ListKey;
import pcgen.cdom.enumeration.ObjectKey;
import pcgen.cdom.enumeration.SourceFormat;
import pcgen.cdom.enumeration.StringKey;
import pcgen.cdom.enumeration.Type;
import pcgen.cdom.inst.PCClassLevel;
import pcgen.core.Ability;
import pcgen.core.Equipment;
import pcgen.core.Globals;
import pcgen.core.PCClass;
import pcgen.core.PCTemplate;
import pcgen.core.Skill;
import pcgen.core.spell.Spell;
import pcgen.facade.core.TempBonusFacade;
import pcgen.system.LanguageBundle;
import pcgen.util.SortKeyAware;

import org.apache.commons.lang3.StringUtils;

/**
 * The Class {@code TempBonusFacadeImpl} a proxy for a TempBonus used for
 * displaying the temporary bonus on the UI. 
 *
 * 
 */

public class TempBonusFacadeImpl implements TempBonusFacade, Comparable&lt;TempBonusFacadeImpl&gt;, SortKeyAware
{

	private final CDOMObject originObj;
	private boolean active;
	private final Object target;
	private final String bonusName;

	/**
	 * Create a new instance of TempBonusFacadeImpl.
	 * @param theOrigin The rules object that defines the bonus.  
	 */
	TempBonusFacadeImpl(CDOMObject theOrigin)
<span class="nc" id="L64">	{</span>
<span class="nc" id="L65">		this.originObj = theOrigin;</span>
<span class="nc" id="L66">		this.active = true;</span>
<span class="nc" id="L67">		this.target = null;</span>
<span class="nc" id="L68">		this.bonusName = null;</span>
<span class="nc" id="L69">	}</span>

	/**
	 * Create a new instance of TempBonusFacadeImpl for an applied bonus.
	 * @param theOrigin The rules object that defines the bonus.  
	 * @param theTarget The target object to which the bonus is applied.
	 * @param bonusName The display name of the bonus (may include target information). 
	 */
	TempBonusFacadeImpl(CDOMObject theOrigin, Object theTarget, String bonusName)
<span class="nc" id="L78">	{</span>
<span class="nc" id="L79">		this.target = theTarget;</span>
<span class="nc" id="L80">		this.bonusName = bonusName;</span>
<span class="nc" id="L81">		this.originObj = theOrigin;</span>
<span class="nc" id="L82">		this.active = true;</span>
<span class="nc" id="L83">	}</span>

	/**
	 * Change the reported active state of this bonus.
	 * @param newActive The new active state of the bonus.
	 */
	void setActive(boolean newActive)
	{
<span class="nc" id="L91">		active = newActive;</span>
<span class="nc" id="L92">	}</span>

	@Override
	public String getSource()
	{
<span class="nc" id="L97">		return SourceFormat.getFormattedString(getOriginObj(), Globals.getSourceDisplay(), true);</span>
	}

	@Override
	public String getSourceForNodeDisplay()
	{
<span class="nc" id="L103">		return SourceFormat.getFormattedString(getOriginObj(), SourceFormat.LONG, false);</span>
	}

	@Override
	public String getKeyName()
	{
<span class="nc" id="L109">		return getOriginObj().getKeyName();</span>
	}

	@Override
	public boolean isNamePI()
	{
<span class="nc" id="L115">		return getOriginObj().getSafe(ObjectKey.NAME_PI);</span>
	}

	@Override
	public String getOriginType()
	{
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (getOriginObj() instanceof Ability)</span>
		{
<span class="nc" id="L123">			return LanguageBundle.getString(&quot;in_Ability&quot;); //$NON-NLS-1$</span>
		}
<span class="nc bnc" id="L125" title="All 2 branches missed.">		if (getOriginObj() instanceof Equipment)</span>
		{
<span class="nc" id="L127">			return LanguageBundle.getString(&quot;in_igEqModelColItem&quot;); //$NON-NLS-1$</span>
		}
<span class="nc bnc" id="L129" title="All 2 branches missed.">		if (getOriginObj() instanceof Spell)</span>
		{
<span class="nc" id="L131">			return LanguageBundle.getString(&quot;in_Spell&quot;); //$NON-NLS-1$</span>
		}
<span class="nc bnc" id="L133" title="All 4 branches missed.">		if (getOriginObj() instanceof PCClass || getOriginObj() instanceof PCClassLevel)</span>
		{
<span class="nc" id="L135">			return LanguageBundle.getString(&quot;in_classString&quot;); //$NON-NLS-1$</span>
		}
<span class="nc bnc" id="L137" title="All 2 branches missed.">		if (getOriginObj() instanceof PCTemplate)</span>
		{
<span class="nc" id="L139">			return LanguageBundle.getString(&quot;in_condition&quot;); //$NON-NLS-1$</span>
		}
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if (getOriginObj() instanceof Skill)</span>
		{
<span class="nc" id="L143">			return LanguageBundle.getString(&quot;in_iskSkill&quot;); //$NON-NLS-1$</span>
		}
<span class="nc" id="L145">		return LanguageBundle.getString(&quot;in_itmRemBonButUnkownBonusType&quot;); //$NON-NLS-1$</span>
	}

	@Override
	public boolean isActive()
	{
<span class="nc" id="L151">		return active;</span>
	}

	/**
	 * @return the target
	 */
	public Object getTarget()
	{
<span class="nc" id="L159">		return target;</span>
	}

	@Override
	public int compareTo(TempBonusFacadeImpl o)
	{
<span class="nc" id="L165">		final Collator collator = Collator.getInstance();</span>

		// Check sort keys first
<span class="nc" id="L168">		String key1 = this.getOriginObj().get(StringKey.SORT_KEY);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if (key1 == null)</span>
		{
<span class="nc" id="L171">			key1 = this.getOriginObj().getDisplayName();</span>
		}
<span class="nc" id="L173">		String key2 = o.getOriginObj().get(StringKey.SORT_KEY);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">		if (key2 == null)</span>
		{
<span class="nc" id="L176">			key2 = o.getOriginObj().getDisplayName();</span>
		}
<span class="nc bnc" id="L178" title="All 2 branches missed.">		if (!key1.equals(key2))</span>
		{
<span class="nc" id="L180">			return collator.compare(key1, key2);</span>
		}
<span class="nc" id="L182">		return collator.compare(this.getOriginObj().getDisplayName(), o.getOriginObj().getDisplayName());</span>
	}

	@Override
	public String toString()
	{
<span class="nc bnc" id="L188" title="All 2 branches missed.">		if (StringUtils.isNotEmpty(bonusName))</span>
		{
<span class="nc" id="L190">			return bonusName;</span>
		}
<span class="nc" id="L192">		return getOriginObj().toString();</span>
	}

	/**
	 * @return the object defining the temporary bonus. 
	 */
	public CDOMObject getOriginObj()
	{
<span class="nc" id="L200">		return originObj;</span>
	}

	@Override
	public int hashCode()
	{
<span class="nc" id="L206">		final int prime = 31;</span>
<span class="nc" id="L207">		int result = 1;</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">		result = prime * result + ((originObj == null) ? 0 : originObj.hashCode());</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">		result = prime * result + ((target == null) ? 0 : target.hashCode());</span>
<span class="nc" id="L210">		return result;</span>
	}

	@Override
	public boolean equals(Object obj)
	{
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if (this == obj)</span>
		{
<span class="nc" id="L218">			return true;</span>
		}
<span class="nc bnc" id="L220" title="All 2 branches missed.">		if (obj == null)</span>
		{
<span class="nc" id="L222">			return false;</span>
		}
<span class="nc bnc" id="L224" title="All 2 branches missed.">		if (getClass() != obj.getClass())</span>
		{
<span class="nc" id="L226">			return false;</span>
		}
<span class="nc" id="L228">		TempBonusFacadeImpl other = (TempBonusFacadeImpl) obj;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">		if (originObj == null)</span>
		{
<span class="nc bnc" id="L231" title="All 2 branches missed.">			if (other.originObj != null)</span>
			{
<span class="nc" id="L233">				return false;</span>
			}
		}
<span class="nc bnc" id="L236" title="All 2 branches missed.">		else if (!originObj.equals(other.originObj))</span>
		{
<span class="nc" id="L238">			return false;</span>
		}
<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (target == null)</span>
		{
<span class="nc bnc" id="L242" title="All 2 branches missed.">            return other.target == null;</span>
		}
		else
		{
<span class="nc" id="L246">			return target.equals(other.target);</span>
		}
    }

	@Override
	public String getType()
	{
<span class="nc" id="L253">		final List&lt;Type&gt; types = originObj.getSafeListFor(ListKey.TYPE);</span>
<span class="nc" id="L254">		return StringUtil.join(types, &quot;.&quot;);</span>
	}

	@Override
	public String getSortKey()
	{
<span class="nc" id="L260">		String sortKey = this.getOriginObj().get(StringKey.SORT_KEY);</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">		if (sortKey == null)</span>
		{
<span class="nc" id="L263">			sortKey = this.getOriginObj().getDisplayName();</span>
		}
<span class="nc" id="L265">		return sortKey;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>